<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Expression Compiler</title><link rel="stylesheet" href="../../book.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="../../static/katex/katex.min.js"></script>
    <script src="../../static/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../-verso-js/popper.js"></script>
    <script src="../../-verso-js/tippy.js"></script>
    <link rel="stylesheet" href="../../static/theme.css">
    <link rel="stylesheet" href="../../static/inter/inter.css">
    <link rel="stylesheet" href="../../static/firacode/fira_code.css">
    <link rel="stylesheet" href="../../static/katex/katex.min.css">
    <link rel="stylesheet" href="../../-verso-css/tippy-border.css">
    <style>
div.collapsible-hint {
  margin: 5px 0;
}

div.collapsible-hint-header {
  padding: 2px;
  font-size: medium;
  cursor: pointer;
  position: relative;
}

div.collapsible-hint-header::after {
  content: "⊢";
  position: absolute;
  left: 50px;
  transition: transform 0.3s ease;
}

div.collapsible-hint-content {
  border: 1px solid white;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

div.collapsible-hint.expanded .collapsible-hint-content {
  max-height: 500px; /* Adjust this value depending on the content's height */
  border: 1px solid lightgrey;
}

div.collapsible-hint.expanded .collapsible-hint-header::after {
  transform: rotate(90deg); /* Rotate to show ">" when expanded */
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5em;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10em;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5em 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5em;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1em;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0em;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1em;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: 0.1rem;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5em;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error {
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2em solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning {
  text-decoration-color: #efd871;
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color: #efd871;
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: #efd871;
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2em solid #efd871;
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2em solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40em;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1em;
  margin-right: 1em;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2em;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1em;
  padding: 0.5em;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5em;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1em;
  height: 0.25em;
  vertical-align: middle;
  width: 0.6em;
  margin-left: 0.1em;
  margin-right: 0.1em;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5em;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5em;
}

.hl.lean .tactic-state details {
  padding-left: 0.5em;
}

.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses td.colon {
  text-align: center;
  min-width: 1em;
}

.hl.lean .tactic-state .hypotheses td.name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses td.name,
.hl.lean .tactic-state .hypotheses td.type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #efd871;
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}



.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
div.TODO {
  border: 5px solid red;
  position: relative;
}
div.TODO::before {
  content: "TODO";
  position: absolute;
  top: 0;
  right: 0;
  color: red;
  font-size: large;
  font-weight: bold;
  transform: rotate(-90deg) translate(-2em);
}
</style><style>
div.collapsible {
  margin: 5px 0;
}

div.collapsible-header {
  padding: 2px;
  font-size: medium;
  cursor: pointer;
  position: relative;
}

div.collapsible-header::after {
  content: "⊢";
  position: absolute;
  left: 60px;
  transition: transform 0.3s ease;
}

div.collapsible-content {
  border: 1px solid white;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

div.collapsible.expanded .collapsible-content {
  max-height: 500px; /* Adjust this value depending on the content's height */
  border: 1px solid lightgrey;
}

div.collapsible.expanded .collapsible-header::after {
  transform: rotate(90deg); /* Rotate to show ">" when expanded */
}
</style><script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    fetch("/-verso-docs.json").then((resp) => resp.json()).then((versoDocData) => {

      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        theme: "lean",
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        ignoreAttributes: true,
        onShow(inst) {
          if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          content.className = "hl lean";
          content.style.display = "block";
          content.style.maxHeight = "300px";
          content.style.overflowY = "auto";
          content.style.overflowX = "hidden";
          const hoverId = tgt.dataset.versoHover;
          const hoverInfo = tgt.querySelector(".hover-info");
          if (hoverId) { // Docstrings from the table
            // TODO stop doing an implicit conversion from string to number here
            let data = versoDocData[hoverId];
            if (data) {
              const info = document.createElement("span");
              info.className = "hover-info";
              info.style.display = "block";
              info.innerHTML = data;
              content.appendChild(info);
              /* Render docstrings - TODO server-side */
              if ('undefined' !== typeof marked) {
                  for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                      const str = d.innerText;
                      const html = marked.parse(str);
                      const rendered = document.createElement("div");
                      rendered.classList.add("docstring");
                      rendered.innerHTML = html;
                      d.parentNode.replaceChild(rendered, d);
                  }
              }
            } else {
              content.innerHTML = "Failed to load doc ID: " + hoverId;
            }
          } else if (hoverInfo) { // The inline info, still used for compiler messages
            content.appendChild(hoverInfo.cloneNode(true));
          }
          return content;
        }
      };

      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      addTippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token', {theme: 'lean'});
      addTippy('.hl.lean .has-info.warning', {theme: 'warning message'});
      addTippy('.hl.lean .has-info.info', {theme: 'info message'});
      addTippy('.hl.lean .has-info.error', {theme: 'error message'});

      tippy('.hl.lean .tactic', {
        allowHtml: true,
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        theme: "tactic",
        placement: 'bottom-start',
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
  });
}
</script>
    </head>
  <body>
    <div class="with-toc">
      <header>
        <h1>
          <a href="../../">Scientific Computing in Lean</a></h1>
        <div id="controls">
          <label for="toggle-toc" id="toggle-toc-click">📖</label></div>
        <div id="print">
          <span>🖨</span></div>
        </header>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc" checked="checked"><ol>
          <li>
            <a href="../../Introduction#Scientific-Computing-in-Lean--Introduction">Introduction</a><ol>
              <li>
                <a href="../../Introduction/About#Scientific-Computing-in-Lean--Introduction--About">About</a></li>
              <li>
                <a href="../../Introduction/Introduction#Scientific-Computing-in-Lean--Introduction--Introduction">Introduction</a><ol>
                  <li>
                    <a href="../../Introduction/Introduction#Scientific-Computing-in-Lean--Introduction--Introduction--Why-Lean-for-Scientific-Computing">Why Lean for Scientific Computing?</a></li>
                  </ol>
                </li>
              </ol>
            </li>
          <li>
            <a href="../../Working-with-Arrays#Scientific-Computing-in-Lean--Working-with-Arrays">Working with Arrays</a><ol>
              <li>
                <a href="../../Working-with-Arrays/Basic-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Basic-Operations">Basic Operations</a><ol>
                  <li>
                    <a href="../../Working-with-Arrays/Basic-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Basic-Operations--Reshaping-Arrays">Reshaping Arrays</a></li>
                  <li>
                    <a href="../../Working-with-Arrays/Basic-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Basic-Operations--Exercises">Exercises</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../Working-with-Arrays/Tensor-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Tensor-Operations">Tensor Operations</a><ol>
                  <li>
                    <a href="../../Working-with-Arrays/Tensor-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Tensor-Operations--Transformations-and-Reductions">Transformations and Reductions</a></li>
                  <li>
                    <a href="../../Working-with-Arrays/Tensor-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Tensor-Operations--Convolution-and-Operations-on-Indices">Convolution and Operations on Indices</a></li>
                  <li>
                    <a href="../../Working-with-Arrays/Tensor-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Tensor-Operations--Pooling-and-Difficulties-with-Dependent-Types">Pooling and Difficulties with Dependent Types</a></li>
                  <li>
                    <a href="../../Working-with-Arrays/Tensor-Operations#Scientific-Computing-in-Lean--Working-with-Arrays--Tensor-Operations--Simple-Neural-Network">Simple Neural Network</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../Working-with-Arrays/Optimizing-Array-Expressions#Scientific-Computing-in-Lean--Working-with-Arrays--Optimizing-Array-Expressions">Optimizing Array Expressions</a><ol>
                  <li>
                    <a href="../../Working-with-Arrays/Optimizing-Array-Expressions#Scientific-Computing-in-Lean--Working-with-Arrays--Optimizing-Array-Expressions--Loop-Fusion">Loop Fusion</a></li>
                  <li>
                    <a href="../../Working-with-Arrays/Optimizing-Array-Expressions#Scientific-Computing-in-Lean--Working-with-Arrays--Optimizing-Array-Expressions--Optimizing-Array-Indexing">Optimizing Array Indexing</a></li>
                  </ol>
                </li>
              </ol>
            </li>
          <li>
            <a href="../../-Differentiation#Scientific-Computing-in-Lean---Differentiation">🚧 Differentiation</a><ol>
              <li>
                <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation">Symbolic Differentiation</a><ol>
                  <li>
                    <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation--Notation">Notation</a></li>
                  <li>
                    <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation--Examples">Examples</a></li>
                  <li>
                    <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation--Gradient">Gradient</a></li>
                  <li>
                    <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation--Derivative-Rules">Derivative Rules</a></li>
                  <li>
                    <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation--Differentiating-Division-Log-Sqrt-">Differentiating Division, Log, Sqrt, ...</a></li>
                  <li>
                    <a href="../../-Differentiation/Symbolic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Symbolic-Differentiation--Abstract-Vector-Spaces">Abstract Vector Spaces</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../-Differentiation/Automatic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Automatic-Differentiation">Automatic Differentiation</a><ol>
                  <li>
                    <a href="../../-Differentiation/Automatic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Automatic-Differentiation--Forward-Mode">Forward Mode</a></li>
                  <li>
                    <a href="../../-Differentiation/Automatic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Automatic-Differentiation--Reverse-Mode">Reverse Mode</a></li>
                  <li>
                    <a href="../../-Differentiation/Automatic-Differentiation#Scientific-Computing-in-Lean---Differentiation--Automatic-Differentiation--Derivatives-of-Neural-Network-Layers">Derivatives of Neural Network Layers</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../-Differentiation/Derivative-Rules#Scientific-Computing-in-Lean---Differentiation--Derivative-Rules">Derivative Rules</a><ol>
                  <li>
                    <a href="../../-Differentiation/Derivative-Rules#Scientific-Computing-in-Lean---Differentiation--Derivative-Rules--Basic-Rules">Basic Rules</a></li>
                  <li>
                    <a href="../../-Differentiation/Derivative-Rules#Scientific-Computing-in-Lean---Differentiation--Derivative-Rules--Rules-with-Conditions">Rules with Conditions</a></li>
                  <li>
                    <a href="../../-Differentiation/Derivative-Rules#Scientific-Computing-in-Lean---Differentiation--Derivative-Rules--Higher-Order-Functions">Higher Order Functions</a></li>
                  <li>
                    <a href="../../-Differentiation/Derivative-Rules#Scientific-Computing-in-Lean---Differentiation--Derivative-Rules--Recursive-Functions">Recursive Functions</a></li>
                  <li>
                    <a href="../../-Differentiation/Derivative-Rules#Scientific-Computing-in-Lean---Differentiation--Derivative-Rules--Custom-Structures">Custom Structures</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../-Differentiation/Differentiating-Array-Expressions#Scientific-Computing-in-Lean---Differentiation--Differentiating-Array-Expressions">Differentiating Array Expressions</a></li>
              <li>
                <a href="../../-Differentiation/Imperative-and-Monadic-Code#Scientific-Computing-in-Lean---Differentiation--Imperative-and-Monadic-Code">Imperative and Monadic Code</a><ol>
                  <li>
                    <a href="../../-Differentiation/Imperative-and-Monadic-Code#Scientific-Computing-in-Lean---Differentiation--Imperative-and-Monadic-Code--Control-flow">Control flow</a></li>
                  <li>
                    <a href="../../-Differentiation/Imperative-and-Monadic-Code#Scientific-Computing-in-Lean---Differentiation--Imperative-and-Monadic-Code--Differentiable-Monad">Differentiable Monad</a></li>
                  <li>
                    <a href="../../-Differentiation/Imperative-and-Monadic-Code#Scientific-Computing-in-Lean---Differentiation--Imperative-and-Monadic-Code--Forward-Derivative-Monad">Forward Derivative Monad</a></li>
                  <li>
                    <a href="../../-Differentiation/Imperative-and-Monadic-Code#Scientific-Computing-in-Lean---Differentiation--Imperative-and-Monadic-Code--Reverse-Derivative-Monad">Reverse Derivative Monad</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../-Differentiation/Variational-Calculus#Scientific-Computing-in-Lean---Differentiation--Variational-Calculus">Variational Calculus</a></li>
              </ol>
            </li>
          <li>
            <a href="../../-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation">🚧 Function Transformation</a><ol>
              <li>
                <a href="../../-Function-Transformation/User-Defined-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation--User-Defined-Function-Transformation">User Defined Function Transformation</a><ol>
                  <li>
                    <a href="../../-Function-Transformation/User-Defined-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation--User-Defined-Function-Transformation--Lambda-Theorems">Lambda Theorems</a></li>
                  <li>
                    <a href="../../-Function-Transformation/User-Defined-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation--User-Defined-Function-Transformation--Function-Theorems">Function Theorems</a></li>
                  <li>
                    <a href="../../-Function-Transformation/User-Defined-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation--User-Defined-Function-Transformation--Free-Variable-Theorems">Free Variable Theorems</a></li>
                  <li>
                    <a href="../../-Function-Transformation/User-Defined-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation--User-Defined-Function-Transformation--Morphism-Theorems">Morphism Theorems</a></li>
                  <li>
                    <a href="../../-Function-Transformation/User-Defined-Function-Transformation#Scientific-Computing-in-Lean---Function-Transformation--User-Defined-Function-Transformation--Advanced-Function-Theorems">Advanced Function Theorems</a></li>
                  </ol>
                </li>
              <li>
                <a href="../../-Function-Transformation/Expression-Compiler#Scientific-Computing-in-Lean---Function-Transformation--Expression-Compiler">Expression Compiler</a><ol>
                  <li>
                    <a href="../../-Function-Transformation/Expression-Compiler#Scientific-Computing-in-Lean---Function-Transformation--Expression-Compiler--Compiling-from-Lean-to-Expressions">Compiling from Lean to Expressions</a></li>
                  </ol>
                </li>
              </ol>
            </li>
          <li>
            <a href="../../Examples#Scientific-Computing-in-Lean--Examples">Examples</a><ol>
              <li>
                <a href="../../Examples/Harmonic-Oscillator#Scientific-Computing-in-Lean--Examples--Harmonic-Oscillator">Harmonic Oscillator</a></li>
              </ol>
            </li>
          </ol>
        </nav>
      <main><section>
          <h1>
            Expression Compiler</h1>
          <p>
            In this section we will show how to write a simple function transformation that compiles certain subset of Lean expressions to a very simple language. </p>
          <p>
            The motivation is that we would like to take a lean function and convert it into a function that can be executed on GPU. We define a simple language of functions that can be executed on GPU.</p>
          <p>
            We will consider a language where every function take <code>r</code> arguments of type <code>Float</code> and returns <code>Float</code></p>
          <p>
            Let's start by defining structures representing primitive functions and constans and then we will define the type representing expressions in our simple language.</p>
          <p>
            A primitive function of arity <code>r</code> is represented by the following structure</p>
          <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-1088">structure</span> <span class="const token" data-binding="const-Function" data-verso-hover="483">Function</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">arity</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-null-1121">where</span>
  <span class="const token" data-binding="const-Function.val" data-verso-hover="484">val</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">arity</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span>
  <span class="const token" data-binding="const-Function.name" data-verso-hover="485">name</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span>
<span class="unknown token" data-binding=""></span></code><p>
            <code>val</code> is the lean interpretation of this function and <code>name</code> is a name of this name of the function in our desired target language.</p>
          <p>
            Note that the input type of <code>val</code> is <code>(Fin r → Float)</code> which one of many representations of an array of <code>r</code> values. Alternativelly we could use type <code>Float × ... × Float</code> as input but working with it is much harder.</p>
          <p>
            For example addition and multiplication of two numbers can be defined as</p>
          <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1623">def</span> <span class="const token" data-binding="const-add" data-verso-hover="486">add</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Function" data-verso-hover="483">Function</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">:=</span>
<span class="unknown token" data-binding="">{</span>
  <span class="const token" data-binding="const-Function.val" data-verso-hover="487">val</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-1658">fun</span> <span class="var token" data-binding="var-_uniq.17" data-verso-hover="488">xs</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.17" data-verso-hover="488">xs</span> <span class="unknown token" data-binding="">0</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.17" data-verso-hover="488">xs</span> <span class="unknown token" data-binding="">1</span>
  <span class="const token" data-binding="const-Function.name" data-verso-hover="489">name</span> <span class="unknown token" data-binding="">:=</span> <span class="literal string token" data-binding="" data-verso-hover="490">"add"</span>
<span class="unknown token" data-binding="">}</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1699">def</span> <span class="const token" data-binding="const-mul" data-verso-hover="491">mul</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Function" data-verso-hover="483">Function</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">:=</span>
<span class="unknown token" data-binding="">{</span>
  <span class="const token" data-binding="const-Function.val" data-verso-hover="487">val</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-1734">fun</span> <span class="var token" data-binding="var-_uniq.131" data-verso-hover="488">xs</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.131" data-verso-hover="488">xs</span> <span class="unknown token" data-binding="">0</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.131" data-verso-hover="488">xs</span> <span class="unknown token" data-binding="">1</span>
  <span class="const token" data-binding="const-Function.name" data-verso-hover="489">name</span> <span class="unknown token" data-binding="">:=</span> <span class="literal string token" data-binding="" data-verso-hover="492">"mul"</span>
<span class="unknown token" data-binding="">}</span>
<span class="unknown token" data-binding=""></span></code><p>
            Similarly for primitive constants of dimension <code>n</code> we use this structure</p>
          <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-1860">structure</span> <span class="const token" data-binding="const-Constant" data-verso-hover="493">Constant</span> <span class="keyword token" data-binding="kw-occ-null-1879">where</span>
  <span class="const token" data-binding="const-Constant.val" data-verso-hover="494">val</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span>
  <span class="const token" data-binding="const-Constant.name" data-verso-hover="495">name</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span>
<span class="keyword token" data-binding="kw-occ-null-1915">deriving</span> <span class="const token" data-binding="const-Inhabited" data-verso-hover="98">Inhabited</span>
<span class="unknown token" data-binding=""></span></code><p>
            An expression of our language is a function of arity <code>r</code>, input dimensions <code>ns 0, ... ns (r-1)</code> and output dimension <code>m</code> is represented by the following inductive data type</p>
          <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-2120" data-verso-hover="496">inductive</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">arity</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span> <span class="keyword token" data-binding="kw-occ-null-2164">where</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">var</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.10" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="4">r</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">fn</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.15" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.17" data-verso-hover="501">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Function" data-verso-hover="483">Function</span> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="4">r</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">const</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.22" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24" data-verso-hover="503">c</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Constant" data-verso-hover="493">Constant</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="var token" data-binding="var-_uniq.22" data-verso-hover="4">r</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">comp</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">s</span> <span class="var token" data-binding="var-_uniq.31" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33" data-verso-hover="505">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">s</span><span class="unknown token" data-binding="">)</span> 
         <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.38" data-verso-hover="506">gs</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36" data-verso-hover="507">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">s</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="var token" data-binding="var-_uniq.31" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="497">ExprRepr</span> <span class="var token" data-binding="var-_uniq.31" data-verso-hover="4">r</span>
<span class="unknown token" data-binding=""></span></code><p>
            The first constructore <code>var</code> allows us to pick one of the input arguments and return it as an output. The next two <code>fn</code> and <code>const</code> creates turns primitive function or constant to an expression. Lastly the <code>comp</code> constructor takes an expression of arity <code>s</code> and composes it with <code>s</code> expressions <code>gs 0, ..., gs (s-1)</code>.</p>
          <p>
            The reason why we named this type <code>ExprRepr</code> and not <code>Expr</code> will be explained a bit later.</p>
          <p>
            For example a function adding a vector to itself would be represented by the following expression</p>
          <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">(ExprRepr.fn add).comp fun x =&gt; ExprRepr.var 1 0 : ExprRepr 1</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-2924">#check</span></span> <span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">ExprRepr.comp</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2956">fun</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">.var</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">0</span><span class="unknown token" data-binding="">)</span>
<span class="unknown token" data-binding=""></span></code><p>
            Which correponds to the expression <code>add(x0, x0)</code> if <code>.var 1 0</code> corresponds to <code>x0</code>.</p>
          <p>
            Now we can write a function that takes an expression <code>(e : ExprRepr r)</code> and turns it into C function. This is very easy because we do not allow for partial applications or lambda abstractions.</p>
          <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3266">def</span> <span class="const token" data-binding="const-ExprRepr.toCCodeBody" data-verso-hover="509">ExprRepr.toCCodeBody</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6" data-verso-hover="510">e</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span> <span class="unknown token" data-binding="">:=</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3322" data-verso-hover="25">match</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="510">e</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3322" data-verso-hover="25">with</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">.var</span> <span class="unknown token" data-binding="">_</span> <span class="var token" data-binding="var-_uniq.23" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="keyword token" data-binding="kw-occ-termS!_-3351">s!</span><span class="unknown token" data-binding="">"x{</span><span class="var token" data-binding="var-_uniq.23" data-verso-hover="499">i</span><span class="unknown token" data-binding="">}"</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">.fn</span> <span class="var token" data-binding="var-_uniq.112" data-verso-hover="501">f</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-ToString.toString" data-verso-hover="512">toString</span> <span class="var token" data-binding="var-_uniq.112" data-verso-hover="501">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Function.name" data-verso-hover="485">name</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">.const</span> <span class="unknown token" data-binding="">_</span> <span class="var token" data-binding="var-_uniq.159" data-verso-hover="503">f</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-ToString.toString" data-verso-hover="512">toString</span> <span class="var token" data-binding="var-_uniq.159" data-verso-hover="503">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Constant.name" data-verso-hover="495">name</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">.comp</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">.const</span> <span class="unknown token" data-binding="">_</span> <span class="var token" data-binding="var-_uniq.220" data-verso-hover="503">f</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-ToString.toString" data-verso-hover="512">toString</span> <span class="var token" data-binding="var-_uniq.220" data-verso-hover="503">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Constant.val" data-verso-hover="494">val</span>
  <span class="unknown token" data-binding="">|</span> <span class="unknown token" data-binding="">@</span><span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">comp</span> <span class="var token" data-binding="var-_uniq.288" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">_</span> <span class="var token" data-binding="var-_uniq.289" data-verso-hover="510">f</span> <span class="var token" data-binding="var-_uniq.290" data-verso-hover="513">gs</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-Id.run" data-verso-hover="6">Id.run</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3495">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-3502">let</span> <span class="keyword token" data-binding="kw-occ-null-3506">mut</span> <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-termS!_-3515">s!</span><span class="unknown token" data-binding="">"{</span><span class="var token" data-binding="var-_uniq.289" data-verso-hover="510">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCodeBody" data-verso-hover="509">toCCodeBody</span><span class="unknown token" data-binding="">}("</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-3540" data-verso-hover="8">for</span> <span class="var token" data-binding="var-_uniq.450" data-verso-hover="499">i</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-3544">in</span> <span class="const token" data-binding="const-SciLean.fullRange" data-verso-hover="60">fullRange</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.288" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-3540" data-verso-hover="8">do</span>
      <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3576">if</span> <span class="var token" data-binding="var-_uniq.450" data-verso-hover="499">i</span><span class="unknown token" data-binding="">.</span><span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">≠</span> <span class="unknown token" data-binding="">0</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3576">then</span>
        <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">++</span> <span class="literal string token" data-binding="" data-verso-hover="515">", "</span>
      <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">++</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.290" data-verso-hover="516">gs</span> <span class="var token" data-binding="var-_uniq.450" data-verso-hover="499">i</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCodeBody" data-verso-hover="509">toCCodeBody</span>
    <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">++</span> <span class="literal string token" data-binding="" data-verso-hover="517">")"</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-3674" data-verso-hover="9">return</span> <span class="var token" data-binding="var-_uniq.528" data-verso-hover="514">s</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3684">def</span> <span class="const token" data-binding="const-ExprRepr.toCCodeHeader" data-verso-hover="518">ExprRepr.toCCodeHeader</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.1819" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1823" data-verso-hover="514">name</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-Id.run" data-verso-hover="6">Id.run</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3763">do</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-3768">let</span> <span class="keyword token" data-binding="kw-occ-null-3772">mut</span> <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-termS!_-3781">s!</span><span class="unknown token" data-binding="">"float {</span><span class="var token" data-binding="var-_uniq.1823" data-verso-hover="514">name</span><span class="unknown token" data-binding="">}("</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-3801" data-verso-hover="8">for</span> <span class="var token" data-binding="var-_uniq.2004" data-verso-hover="499">i</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-3805">in</span> <span class="const token" data-binding="const-SciLean.fullRange" data-verso-hover="60">fullRange</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.1826" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-3801" data-verso-hover="8">do</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3835">if</span> <span class="var token" data-binding="var-_uniq.2004" data-verso-hover="499">i</span><span class="unknown token" data-binding="">.</span><span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">≠</span> <span class="unknown token" data-binding="">0</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3835">then</span>
      <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">++</span> <span class="literal string token" data-binding="" data-verso-hover="515">", "</span>
    <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">++</span> <span class="keyword token" data-binding="kw-occ-termS!_-3888">s!</span><span class="unknown token" data-binding="">"float x{</span><span class="var token" data-binding="var-_uniq.2004" data-verso-hover="499">i</span><span class="unknown token" data-binding="">}"</span>
  <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span> <span class="unknown token" data-binding="">++</span> <span class="literal string token" data-binding="" data-verso-hover="517">")"</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-3921" data-verso-hover="9">return</span> <span class="var token" data-binding="var-_uniq.2083" data-verso-hover="514">s</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3931">def</span> <span class="const token" data-binding="const-ExprRepr.toCCode" data-verso-hover="519">ExprRepr.toCCode</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2458" data-verso-hover="510">e</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.2456" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2460" data-verso-hover="514">name</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-Id.run" data-verso-hover="6">Id.run</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-4004">do</span>
  <span class="keyword token" data-binding="kw-occ-termS!_-4009">s!</span><span class="unknown token" data-binding="">"{</span><span class="var token" data-binding="var-_uniq.2458" data-verso-hover="510">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCodeHeader" data-verso-hover="518">toCCodeHeader</span> <span class="var token" data-binding="var-_uniq.2460" data-verso-hover="514">name</span><span class="unknown token" data-binding="">}\{\n  return {</span><span class="var token" data-binding="var-_uniq.2458" data-verso-hover="510">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCodeBody" data-verso-hover="509">toCCodeBody</span><span class="unknown token" data-binding="">};\n}"</span>
<span class="unknown token" data-binding=""></span></code><p>
            Let's compile the previous example </p>
          <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">"float add_self(float x0){\n  return add(x0, x0);\n}"
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-4137">#eval</span></span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">ExprRepr.comp</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">.fn</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-add" data-verso-hover="508">add</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-4171">fun</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">.var</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">0</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span>
      <span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-ExprRepr.toCCode" data-verso-hover="519">toCCode</span> <span class="literal string token" data-binding="" data-verso-hover="520">"add_self"</span>
<span class="unknown token" data-binding=""></span></code><div class="information">
            <pre>"float add_self(float x0){\n  return add(x0, x0);\n}"
</pre></div>
          <section>
            <h2 id="Scientific-Computing-in-Lean---Function-Transformation--Expression-Compiler--Compiling-from-Lean-to-Expressions">
              Compiling from Lean to Expressions</h2>
            <p>
              Writing down <code>ExprRepr</code> is very tedious. We would like to take a Lean expression on automatically turn in into <code>ExprRepr</code> is possible. Therefore let's define a funciton <code>compile</code> that turns a Lean expression to <code>ExprRepr</code>. Before doing so we need to define a function <code>ExprRepr.toLean</code> taking <code>(e : ExprRepr r ns m)</code> and interpreting it as a Lean function of type <code>((i : Fin r) → Float) → Float</code>. Once we have this function we can formally specify <code>compile</code> function.</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4834">def</span> <span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">ExprRepr.toLean</span> 
    <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6" data-verso-hover="510">e</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.11" data-verso-hover="522">xs</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.9" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">:=</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4918" data-verso-hover="25">match</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="510">e</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4918" data-verso-hover="25">with</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">var</span> <span class="unknown token" data-binding="">_</span> <span class="var token" data-binding="var-_uniq.31" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.11" data-verso-hover="522">xs</span> <span class="var token" data-binding="var-_uniq.31" data-verso-hover="499">i</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">.fn</span> <span class="var token" data-binding="var-_uniq.43" data-verso-hover="501">f</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.43" data-verso-hover="501">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Function.val" data-verso-hover="484">val</span> <span class="var token" data-binding="var-_uniq.11" data-verso-hover="522">xs</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">.const</span> <span class="unknown token" data-binding="">_</span> <span class="var token" data-binding="var-_uniq.57" data-verso-hover="503">c</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.57" data-verso-hover="503">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Constant.val" data-verso-hover="494">val</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">.comp</span> <span class="var token" data-binding="var-_uniq.82" data-verso-hover="523">f</span> <span class="var token" data-binding="var-_uniq.83" data-verso-hover="524">gs</span> <span class="unknown token" data-binding="">=&gt;</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-5019" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.95" data-verso-hover="525">f'</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.82" data-verso-hover="523">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">toLean</span>
    <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-5042" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.110" data-verso-hover="526">ys</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-5052">fun</span> <span class="var token" data-binding="var-_uniq.100" data-verso-hover="527">j</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.83" data-verso-hover="524">gs</span> <span class="var token" data-binding="var-_uniq.100" data-verso-hover="527">j</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">toLean</span> <span class="var token" data-binding="var-_uniq.11" data-verso-hover="522">xs</span>
    <span class="var token" data-binding="var-_uniq.95" data-verso-hover="525">f'</span> <span class="var token" data-binding="var-_uniq.110" data-verso-hover="526">ys</span>
<span class="unknown token" data-binding=""></span></code><p>
              Now we can define/specify <code>compile</code> function in nonconstructive way. If there is a representation <code>(e : Expr r)</code> a a function <code>f</code> then return it otherwise return some junk value.</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-5296" data-verso-hover="13">open</span> <span class="unknown token" data-binding="">Classical</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-5296">in</span>
<span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.noncomputable-5327">noncomputable</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5341">def</span> <span class="const token" data-binding="const-compile" data-verso-hover="528">compile</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="91">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">:=</span>
  <span class="keyword token" data-binding="kw-occ-termDepIfThenElse-5393" data-verso-hover="529">if</span> <span class="var token" data-binding="var-_uniq.446" data-verso-hover="530">h</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">∃</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.25" data-verso-hover="531">e</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="unknown token" data-binding="">1</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span> 
           <span class="var token" data-binding="var-_uniq.4" data-verso-hover="91">f</span> <span class="unknown token" data-binding="">=</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-5439">fun</span> <span class="var token" data-binding="var-_uniq.30" data-verso-hover="79">x</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.25" data-verso-hover="531">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">toLean</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-5458">fun</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.30" data-verso-hover="79">x</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-termDepIfThenElse-5393" data-verso-hover="529">then</span>
    <span class="const token" data-binding="const-Classical.choose" data-verso-hover="532">choose</span> <span class="var token" data-binding="var-_uniq.446" data-verso-hover="530">h</span>
  <span class="keyword token" data-binding="kw-occ-termDepIfThenElse-5393" data-verso-hover="529">else</span>
    <span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">.const</span> <span class="unknown token" data-binding="">_</span> <span class="const token" data-binding="const-Inhabited.default" data-verso-hover="63">default</span>
<span class="unknown token" data-binding=""></span></code><p>
              Unfortunatelly this definition has a serious flaw. For a function <code>(f : Float → Float)</code> there can be multiple expressions <code>ExprRepr</code> representing this function. Therefore <code>compile f</code> is not really uniquelly defined and as it is we would not be able to prove anything about this funciton.</p>
            <p>
              The usuall mathematical remedy is to work with equivalence classes of all the expressions that represent the same function. This might sound a bit bizare for any practical purposes but we are in luck because Lean has first class support for quotient types. We can define <code>Expr r</code> as equivalence class of all the expressions <code>(e : ExprRepr r)</code> such that they have the same interpretation as lean functions.</p>
            <p>
              To define <code>Expr</code> we first have to equip <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span></code> with a natural notion of equivalence i.e. <code>e</code> and <code>e'</code> are equivalent if their Lean interpretations are the same. The typeclass <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Setoid" data-verso-hover="533">Setoid</span></code> execatly captures that fact that a type has a natural notion of a equivalence.</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-6507">instance</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Setoid" data-verso-hover="533">Setoid</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-6542">where</span>
  <span class="const token" data-binding="const-Setoid.r" data-verso-hover="534">r</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6555">fun</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="510">e</span> <span class="var token" data-binding="var-_uniq.16" data-verso-hover="510">e'</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="510">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">toLean</span> <span class="unknown token" data-binding="">=</span> <span class="var token" data-binding="var-_uniq.16" data-verso-hover="510">e'</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">toLean</span>
  <span class="const token" data-binding="const-Setoid.iseqv" data-verso-hover="535">iseqv</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-1489069134505402385-6599-6601"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-6599" data-verso-hover="69">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-1489069134505402385-6599-6601"><div class="tactic-state"><div class="goal"><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Equivalence" data-verso-hover="536">Equivalence</span> <span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">e</span> <span class="var token" data-binding="var-_uniq.235" data-verso-hover="510">e'</span> =&gt; <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">e</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.235" data-verso-hover="510">e'</span>.toLean</span></span></div></div></span> <span class="tactic"><label for="tactic-state-12525344178074486803-6602-6613"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-6602" data-verso-hover="453">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-12525344178074486803-6602-6613"><div class="tactic-state"><div class="goal"><details open="open"><summary><span class="goal-name">refl</span></summary><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ (<span class="var token" data-binding="var-_uniq.233" data-verso-hover="510">x</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>), <span class="var token" data-binding="var-_uniq.233" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.233" data-verso-hover="510">x</span>.toLean</span></span></details></div><div class="goal"><details><summary><span class="goal-name">symm</span></summary><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ {<span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>}, <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean → <span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean</span></span></details></div><div class="goal"><details><summary><span class="goal-name">trans</span></summary><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ {<span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="510">z</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>}, <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean → <span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="510">z</span>.toLean → <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="510">z</span>.toLean</span></span></details></div></div></span> <span class="tactic"><label for="tactic-state-12525344178074486803-6614-6617"><span class="unknown token" data-binding="">&lt;;&gt;</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-12525344178074486803-6614-6617"><div class="tactic-state"><div class="goal"><details open="open"><summary><span class="goal-name">refl</span></summary><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ (<span class="var token" data-binding="var-_uniq.233" data-verso-hover="510">x</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>), <span class="var token" data-binding="var-_uniq.233" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.233" data-verso-hover="510">x</span>.toLean</span></span></details></div><div class="goal"><details><summary><span class="goal-name">symm</span></summary><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ {<span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>}, <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean → <span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean</span></span></details></div><div class="goal"><details><summary><span class="goal-name">trans</span></summary><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ {<span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="510">z</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>}, <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean → <span class="var token" data-binding="var-_uniq.236" data-verso-hover="510">y</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="510">z</span>.toLean → <span class="var token" data-binding="var-_uniq.234" data-verso-hover="510">x</span>.toLean<span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span><span class="var token" data-binding="var-_uniq.238" data-verso-hover="510">z</span>.toLean</span></span></details></div></div></span> <span class="tactic"><label for="tactic-state-7-6618-6623"><span class="keyword token" data-binding="kw-occ-Aesop.Frontend.Parser.aesopTactic-6618" data-verso-hover="315">aesop</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-6618-6623"><div class="tactic-state">All goals completed! 🐙</div></span>
<span class="unknown token" data-binding=""></span></code><p>
              Once we have <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Setoid" data-verso-hover="533">Setoid</span></code> structure on <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span></code> we can quotion define <code>Expr</code> using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quotient" data-verso-hover="537">Quotient</span></code>.</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6748">def</span> <span class="const token" data-binding="const-Expr" data-verso-hover="538">Expr</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-Quotient" data-verso-hover="537">Quotient</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">α</span><span class="unknown token" data-binding="">:=</span><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-3683385185563809225-6791-6793"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-6791" data-verso-hover="69">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-3683385185563809225-6791-6793"><div class="tactic-state"><div class="goal"><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Setoid" data-verso-hover="533">Setoid</span> (<span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span>)</span></span></div></div></span> <span class="tactic"><label for="tactic-state-7-6794-6808"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticInfer_instance-6794" data-verso-hover="539">infer_instance</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-6794-6808"><div class="tactic-state">All goals completed! 🐙</div></span><span class="unknown token" data-binding="">)</span>
<span class="unknown token" data-binding=""></span></code><section>
              <h3 id="Scientific-Computing-in-Lean---Function-Transformation--Expression-Compiler--Compiling-from-Lean-to-Expressions--Quotient-Intermezzo">
                Quotient Intermezzo</h3>
              <div class="TODO">
                <p>
                  Rewrite this subsection to also use <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quotient" data-verso-hover="537">Quotient</span></code>.</p>
                </div>
              <p>
                In general, for a relation <code>(r : X → X → Prop)</code> the type <code>Quot r</code> will create a quotient of <code>X</code> along the relation <code>r</code>. (More preciselly, <code>Quot r</code> is a quotient of <code>X</code> along the smallest relation containing <code>r</code>). Working with quotient is actually very common in programming. For example, we can represent multisets of natural numbers <code>List Nat</code> but we have two options how to maintain the multiset invariant. Either work with lists that are sorted</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7369">def</span> <span class="const token" data-binding="const-MultiSetV1" data-verso-hover="540">MultiSetV1</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">{</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="24">l</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-List" data-verso-hover="20">List</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span> <span class="unknown token" data-binding="">//</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="24">l</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.Sorted" data-verso-hover="541">Sorted</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span> <span class="unknown token" data-binding="">≤</span> <span class="unknown token" data-binding="">·</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">}</span>
<span class="unknown token" data-binding=""></span></code><p>
                This is the usual approach as maintaining the sorted invariant is relativelly easy.</p>
              <p>
                Alternativelly, we can work with unsorted lists but we require that any function consuming such list produces the same values whenever we permute the list. This is a really dangerous and error prone way of working with multisets and it is almost never done this way. In Lean, things can be different as it is theorem prover and such invariant is not just an gentleman agreement but the compiler can force user to prove it everytime they use a multiset. </p>
              <p>
                Therefore we can define a relation <code>multiSetRel : List Nat → List Nat → Prop</code> </p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-8062">structure</span> <span class="const token" data-binding="const-multiSetRel" data-verso-hover="542">multiSetRel</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="24">l</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="24">l'</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-List" data-verso-hover="20">List</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="sort token" data-binding="">Prop</span> <span class="keyword token" data-binding="kw-occ-null-8109">where</span>
  <span class="const token" data-binding="const-multiSetRel.hl" data-verso-hover="543">hl</span> <span class="unknown token" data-binding="">:</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="24">l</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="544">length</span> <span class="unknown token" data-binding="">=</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="24">l'</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="544">length</span>
  <span class="const token" data-binding="const-multiSetRel.hperm" data-verso-hover="545">hperm</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">∃</span> <span class="var token" data-binding="var-_uniq.35" data-verso-hover="546">π</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="24">l</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="544">length</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="24">l</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="544">length</span><span class="unknown token" data-binding="">,</span> 
    <span class="var token" data-binding="var-_uniq.35" data-verso-hover="546">π</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Function.Bijective" data-verso-hover="547">Bijective</span> <span class="unknown token" data-binding="">∧</span> <span class="unknown token" data-binding="">∀</span> <span class="var token" data-binding="var-_uniq.47" data-verso-hover="548">i</span><span class="unknown token" data-binding="">,</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="24">l</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.get" data-verso-hover="549">get</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.35" data-verso-hover="546">π</span> <span class="var token" data-binding="var-_uniq.47" data-verso-hover="548">i</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="24">l'</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.get" data-verso-hover="549">get</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20" data-verso-hover="550">hl</span><span class="unknown token" data-binding="">▸</span> <span class="var token" data-binding="var-_uniq.47" data-verso-hover="548">i</span><span class="unknown token" data-binding="">)</span>
<span class="unknown token" data-binding=""></span></code><p>
                waking that <code>multiSetRel l l</code> are equivalent if they have the same length <code>hl</code> and there exists a permuation <code>π</code> such that if we permute <code>l</code> by it we obtain <code>l'</code>.</p>
              <p>
                Now we can define multisets as a quotient of <code>List Nat</code> by this relation.</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-8505">def</span> <span class="const token" data-binding="const-MultiSetV2" data-verso-hover="551">MultiSetV2</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-Quot" data-verso-hover="552">Quot</span> <span class="const token" data-binding="const-multiSetRel" data-verso-hover="542">multiSetRel</span>
<span class="unknown token" data-binding=""></span></code><p>
                Using function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quot.lift" data-verso-hover="553">Quot.lift</span></code> can for example define a function <code>sum</code> that adds all the elements together</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-8662">def</span> <span class="const token" data-binding="const-MultiSetV2.sum" data-verso-hover="554">MultiSetV2.sum</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="555">s</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-MultiSetV2" data-verso-hover="556">MultiSetV2</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span> <span class="unknown token" data-binding="">:=</span>
  <span class="const token" data-binding="const-Quot.lift" data-verso-hover="553">Quot.lift</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-8720">fun</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="24">repr</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="unknown token" data-binding="">∑</span> <span class="var token" data-binding="var-_uniq.366" data-verso-hover="557">i</span><span class="unknown token" data-binding="">,</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="24">repr</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.get" data-verso-hover="549">get</span> <span class="var token" data-binding="var-_uniq.366" data-verso-hover="557">i</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-8751" data-verso-hover="67">sorry_proof</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="555">s</span>
<span class="unknown token" data-binding=""></span></code><p>
                As we are not too interested in proving things in this book we just omit the proof with <code>sorry_proof</code> but this anytime we use <code>Quot.lift</code> to work with <code>(s : MultiSetV2)</code> through its list representation we are reminded that such function should be independent on the particular odering of the list.</p>
              <p>
                One big advantage of the second approach to multisets is that it does not use ordering on the numbers therefore we can have a multiset of objects that can't be ordered.</p>
              <p>
                Lasty, for an element <code>(x : X)</code> and relation <code>r : X → X → Prop</code> we can create and element of the quotient <code>Quot r</code> with <code>Quot.mk r x</code>. Usually we omit <code>r</code> as it can be infered from the context. </p>
              <p>
                For example we can create a multiset from the list <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">0</span><span class="unknown token" data-binding="">,</span><span class="unknown token" data-binding="">4</span><span class="unknown token" data-binding="">,</span><span class="unknown token" data-binding="">3</span><span class="unknown token" data-binding="">,</span><span class="unknown token" data-binding="">10</span><span class="unknown token" data-binding="">]</span></code>.</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">Quot.mk multiSetRel [0, 4, 3, 10] : Quot multiSetRel</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-9517">#check</span></span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Quot.mk" data-verso-hover="558">Quot.mk</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">0</span><span class="unknown token" data-binding="">,</span><span class="unknown token" data-binding="">4</span><span class="unknown token" data-binding="">,</span><span class="unknown token" data-binding="">3</span><span class="unknown token" data-binding="">,</span><span class="unknown token" data-binding="">10</span><span class="unknown token" data-binding="">]</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-MultiSetV2" data-verso-hover="556">MultiSetV2</span><span class="unknown token" data-binding="">)</span>
<span class="unknown token" data-binding=""></span></code><div class="TODO">
                <p>
                  Talk about <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quot.unquot" data-verso-hover="559">Quot.unquot</span></code> which allows us to recover the runtime representant of <code>(x : Quot r)</code></p>
                </div>
              </section>
            <section>
              <h3 id="Scientific-Computing-in-Lean---Function-Transformation--Expression-Compiler--Compiling-from-Lean-to-Expressions--Back-to-Compilation">
                Back to Compilation</h3>
              <p>
                Let's go back to compiling lean expressions. Hopefully we have convinced you that the </p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-9802" data-verso-hover="13">open</span> <span class="unknown token" data-binding="">Classical</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-9802">in</span>
<span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.noncomputable-9833">noncomputable</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9847">def</span> <span class="const token" data-binding="const-compile" data-verso-hover="560">compile</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.12" data-verso-hover="561">f</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">:=</span>
  <span class="keyword token" data-binding="kw-occ-termDepIfThenElse-9907" data-verso-hover="529">if</span> <span class="var token" data-binding="var-_uniq.510" data-verso-hover="563">h</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">∃</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.22" data-verso-hover="564">e</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.17" data-verso-hover="4">n</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span> 
           <span class="var token" data-binding="var-_uniq.12" data-verso-hover="561">f</span> <span class="unknown token" data-binding="">=</span> <span class="var token" data-binding="var-_uniq.22" data-verso-hover="564">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toLean" data-verso-hover="521">toLean</span> <span class="keyword token" data-binding="kw-occ-termDepIfThenElse-9907" data-verso-hover="529">then</span>
    <span class="unknown token" data-binding="">⟦</span><span class="const token" data-binding="const-Classical.choose" data-verso-hover="532">choose</span> <span class="var token" data-binding="var-_uniq.510" data-verso-hover="563">h</span><span class="unknown token" data-binding="">⟧</span>
  <span class="keyword token" data-binding="kw-occ-termDepIfThenElse-9907" data-verso-hover="529">else</span>
    <span class="unknown token" data-binding="">⟦</span><span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">.const</span> <span class="unknown token" data-binding="">_</span> <span class="const token" data-binding="const-Inhabited.default" data-verso-hover="63">default</span><span class="unknown token" data-binding="">⟧</span>
<span class="unknown token" data-binding=""></span></code><p>
                Working with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quot.mk" data-verso-hover="558">Quot.mk</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quot.lift" data-verso-hover="553">Quot.lift</span></code> is tedious so often we want to define the same function that live on the original type as on the quotient type. In our case we want to define analogues of  <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">ExprRepr.var</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">ExprRepr.fn</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">ExprRepr.const</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">ExprRepr.comp</span></code> on <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span></code>.</p>
              <p>
                The first three are very easy</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10379">def</span> <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">⟦</span><span class="const token" data-binding="const-ExprRepr.var" data-verso-hover="498">.var</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="499">i</span><span class="unknown token" data-binding="">⟧</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10441">def</span> <span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24" data-verso-hover="501">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Function" data-verso-hover="483">Function</span> <span class="var token" data-binding="var-_uniq.22" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.22" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">⟦</span><span class="const token" data-binding="const-ExprRepr.fn" data-verso-hover="500">.fn</span> <span class="var token" data-binding="var-_uniq.24" data-verso-hover="501">f</span><span class="unknown token" data-binding="">⟧</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10494">def</span> <span class="const token" data-binding="const-Expr.const" data-verso-hover="567">Expr.const</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.43" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.45" data-verso-hover="503">c</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Constant" data-verso-hover="493">Constant</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.43" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">⟦</span><span class="const token" data-binding="const-ExprRepr.const" data-verso-hover="502">.const</span> <span class="var token" data-binding="var-_uniq.43" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.45" data-verso-hover="503">c</span><span class="unknown token" data-binding="">⟧</span>
<span class="unknown token" data-binding=""></span></code><p>
                The last one is quite a bit harder as it accepts <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span></code> as input therefore we need to use <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quot.lift" data-verso-hover="553">Quot.lift</span></code> to define the function on the representan <code>ExprRepr</code> and then show it is independent.</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10776">def</span> <span class="const token" data-binding="const-Expr.comp" data-verso-hover="568">Expr.comp</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.15" data-verso-hover="569">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">s</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20" data-verso-hover="570">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.18" data-verso-hover="507">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">s</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:=</span>
  <span class="var token" data-binding="var-_uniq.15" data-verso-hover="569">f</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Quotient.lift" data-verso-hover="571">lift</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10854">fun</span> <span class="var token" data-binding="var-_uniq.46" data-verso-hover="505">frepr</span> <span class="unknown token" data-binding="">=&gt;</span>
    <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Quotient.finLiftOn" data-verso-hover="572">Quotient.finLiftOn</span> <span class="var token" data-binding="var-_uniq.20" data-verso-hover="570">g</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10894">fun</span> <span class="var token" data-binding="var-_uniq.361" data-verso-hover="506">gsrepr</span> <span class="unknown token" data-binding="">=&gt;</span> 
      <span class="unknown token" data-binding="">⟦</span><span class="const token" data-binding="const-ExprRepr.comp" data-verso-hover="504">.comp</span> <span class="var token" data-binding="var-_uniq.46" data-verso-hover="505">frepr</span> <span class="var token" data-binding="var-_uniq.361" data-verso-hover="506">gsrepr</span><span class="unknown token" data-binding="">⟧</span><span class="unknown token" data-binding="">)</span> 
    <span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-14894744794627822493-10947-10949"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-10947" data-verso-hover="69">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-14894744794627822493-10947-10949"><div class="tactic-state"><div class="goal"><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.15" data-verso-hover="569">f</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.20" data-verso-hover="570">g</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span> → <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">r</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.46" data-verso-hover="505">frepr</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ (<span class="var token" data-binding="var-_uniq.470" data-verso-hover="506">a </span><span class="var token" data-binding="var-_uniq.472" data-verso-hover="506">b</span> : <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span> → <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">r</span>),
  (∀ (<span class="var token" data-binding="var-_uniq.488" data-verso-hover="507">i</span> : <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span>), <span class="var token" data-binding="var-_uniq.470" data-verso-hover="506">a</span> <span class="var token" data-binding="var-_uniq.488" data-verso-hover="507">i</span><span class="const token" data-binding="const-HasEquiv.Equiv" data-verso-hover="573"> ≈ </span><span class="var token" data-binding="var-_uniq.472" data-verso-hover="506">b</span> <span class="var token" data-binding="var-_uniq.488" data-verso-hover="507">i</span>) → (<span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.476" data-verso-hover="506">gsrepr</span> =&gt; ⟦<span class="var token" data-binding="var-_uniq.46" data-verso-hover="505">frepr</span>.comp <span class="var token" data-binding="var-_uniq.476" data-verso-hover="506">gsrepr</span>⟧) <span class="var token" data-binding="var-_uniq.470" data-verso-hover="506">a</span><span class="const token" data-binding="const-Eq" data-verso-hover="71"> = </span>(<span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.482" data-verso-hover="506">gsrepr</span> =&gt; ⟦<span class="var token" data-binding="var-_uniq.46" data-verso-hover="505">frepr</span>.comp <span class="var token" data-binding="var-_uniq.482" data-verso-hover="506">gsrepr</span>⟧) <span class="var token" data-binding="var-_uniq.472" data-verso-hover="506">b</span></span></span></div></div></span> <span class="tactic"><label for="tactic-state-7-10950-10961"><span class="keyword token" data-binding="kw-occ-SciLean.tacticSorry_proof-10950" data-verso-hover="457">sorry_proof</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-10950-10961"><div class="tactic-state">All goals completed! 🐙</div></span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> 
  <span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-8834911308623956947-10969-10971"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-10969" data-verso-hover="69">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-8834911308623956947-10969-10971"><div class="tactic-state"><div class="goal"><table class="hypotheses"><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">r</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Nat" data-verso-hover="5">ℕ</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.15" data-verso-hover="569">f</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span></td></tr><tr class="hypothesis"><td class="name"><span class="var token" data-binding="var-_uniq.20" data-verso-hover="570">g</span></td><td class="colon">:</td><td class="type"><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span> → <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.29" data-verso-hover="4">r</span></td></tr></table><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∀ (<span class="var token" data-binding="var-_uniq.470" data-verso-hover="505">a </span><span class="var token" data-binding="var-_uniq.472" data-verso-hover="505">b</span> : <span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="4">s</span>),
  <span class="var token" data-binding="var-_uniq.470" data-verso-hover="505">a</span><span class="const token" data-binding="const-HasEquiv.Equiv" data-verso-hover="573"> ≈ </span><span class="var token" data-binding="var-_uniq.472" data-verso-hover="505">b</span> →
    (<span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.475" data-verso-hover="505">frepr</span> =&gt; <span class="const token" data-binding="const-Quotient.finLiftOn" data-verso-hover="572">Quotient.finLiftOn</span> <span class="var token" data-binding="var-_uniq.20" data-verso-hover="570">g</span> (<span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.510" data-verso-hover="506">gsrepr</span> =&gt; ⟦<span class="var token" data-binding="var-_uniq.475" data-verso-hover="505">frepr</span>.comp <span class="var token" data-binding="var-_uniq.510" data-verso-hover="506">gsrepr</span>⟧) ⋯) <span class="var token" data-binding="var-_uniq.470" data-verso-hover="505">a</span><span class="const token" data-binding="const-Eq" data-verso-hover="71"> =
      </span>(<span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.516" data-verso-hover="505">frepr</span> =&gt; <span class="const token" data-binding="const-Quotient.finLiftOn" data-verso-hover="572">Quotient.finLiftOn</span> <span class="var token" data-binding="var-_uniq.20" data-verso-hover="570">g</span> (<span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="506">gsrepr</span> =&gt; ⟦<span class="var token" data-binding="var-_uniq.516" data-verso-hover="505">frepr</span>.comp <span class="var token" data-binding="var-_uniq.529" data-verso-hover="506">gsrepr</span>⟧) ⋯) <span class="var token" data-binding="var-_uniq.472" data-verso-hover="505">b</span></span></span></div></div></span> <span class="tactic"><label for="tactic-state-7-10972-10983"><span class="keyword token" data-binding="kw-occ-SciLean.tacticSorry_proof-10972" data-verso-hover="457">sorry_proof</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-10972-10983"><div class="tactic-state">All goals completed! 🐙</div></span><span class="unknown token" data-binding="">)</span>
<span class="unknown token" data-binding=""></span></code><p>
                We can start writing function transformation theorems. The identity rule takes a function that picks one of the inputs and produces <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span></code></p>
              <code class="hl lean block" data-lean-context="examples"><span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.theorem-11160">theorem</span> <span class="const token" data-binding="const-compile.id_rule" data-verso-hover="574">compile.id_rule</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6" data-verso-hover="32">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">n</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> 
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11210">fun</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="576">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.13" data-verso-hover="576">x</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="32">i</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=</span> <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">.var</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="4">n</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="32">i</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-11258" data-verso-hover="67">sorry_proof</span>
<span class="unknown token" data-binding=""></span></code><p>
                The composition rule has to take function <code>f</code> with arity <code>s</code> and a collection of <code>s</code> functions <code>(g · i)</code> with arity <code>r</code>.</p>
              <code class="hl lean block" data-lean-context="examples"><span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.theorem-11418">theorem</span> <span class="const token" data-binding="const-compile.comp_rule" data-verso-hover="577">compile.comp_rule</span> 
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24" data-verso-hover="578">f</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="4">s</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.32" data-verso-hover="579">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.18" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="4">s</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> 
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11539">fun</span> <span class="var token" data-binding="var-_uniq.38" data-verso-hover="522">x</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.24" data-verso-hover="578">f</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.32" data-verso-hover="579">g</span> <span class="var token" data-binding="var-_uniq.38" data-verso-hover="522">x</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> 
  <span class="unknown token" data-binding="">=</span> 
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11565" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.57" data-verso-hover="569">f'</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="var token" data-binding="var-_uniq.24" data-verso-hover="578">f</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11587" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.75" data-verso-hover="570">g'</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11597">fun</span> <span class="var token" data-binding="var-_uniq.62" data-verso-hover="507">i</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.32" data-verso-hover="579">g</span> <span class="unknown token" data-binding="">·</span> <span class="var token" data-binding="var-_uniq.62" data-verso-hover="507">i</span><span class="unknown token" data-binding="">)</span>
  <span class="const token" data-binding="const-Expr.comp" data-verso-hover="568">.comp</span> <span class="var token" data-binding="var-_uniq.57" data-verso-hover="569">f'</span> <span class="var token" data-binding="var-_uniq.75" data-verso-hover="570">g'</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-11640" data-verso-hover="67">sorry_proof</span>
<span class="unknown token" data-binding=""></span></code><div class="TODO">
                <p>
                  As stated these theorems are false. We should add a predicate that function is compilable <code>IsCompilable f</code>.</p>
                </div>
              <p>
                Function transformation theorem for addition and multiplication</p>
              <code class="hl lean block" data-lean-context="examples"><span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.theorem-11867">theorem</span> <span class="const token" data-binding="const-compile.add_rule" data-verso-hover="580">compile.add_rule</span> 
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.12" data-verso-hover="561">f</span> <span class="var token" data-binding="var-_uniq.18" data-verso-hover="561">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> 
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11945">fun</span> <span class="var token" data-binding="var-_uniq.24" data-verso-hover="576">x</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="561">f</span> <span class="var token" data-binding="var-_uniq.24" data-verso-hover="576">x</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.18" data-verso-hover="561">g</span> <span class="var token" data-binding="var-_uniq.24" data-verso-hover="576">x</span><span class="unknown token" data-binding="">)</span> 
  <span class="unknown token" data-binding="">=</span> 
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11973" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.90" data-verso-hover="581">f'</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="561">f</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11995" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.99" data-verso-hover="581">g'</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="var token" data-binding="var-_uniq.18" data-verso-hover="561">g</span>
  <span class="const token" data-binding="const-Expr.comp" data-verso-hover="568">.comp</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">![</span><span class="var token" data-binding="var-_uniq.90" data-verso-hover="581">f'</span><span class="unknown token" data-binding="">,</span><span class="var token" data-binding="var-_uniq.99" data-verso-hover="581">g'</span><span class="unknown token" data-binding="">]</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-12045" data-verso-hover="67">sorry_proof</span>

<span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.theorem-12071">theorem</span> <span class="const token" data-binding="const-compile.mul_rule" data-verso-hover="582">compile.mul_rule</span> 
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.212" data-verso-hover="561">f</span> <span class="var token" data-binding="var-_uniq.218" data-verso-hover="561">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.206" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> 
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12149">fun</span> <span class="var token" data-binding="var-_uniq.224" data-verso-hover="576">x</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.212" data-verso-hover="561">f</span> <span class="var token" data-binding="var-_uniq.224" data-verso-hover="576">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.218" data-verso-hover="561">g</span> <span class="var token" data-binding="var-_uniq.224" data-verso-hover="576">x</span><span class="unknown token" data-binding="">)</span> 
  <span class="unknown token" data-binding="">=</span> 
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-12177" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.298" data-verso-hover="581">f'</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="var token" data-binding="var-_uniq.212" data-verso-hover="561">f</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-12199" data-verso-hover="78">let</span> <span class="var token" data-binding="var-_uniq.307" data-verso-hover="581">g'</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="var token" data-binding="var-_uniq.218" data-verso-hover="561">g</span>
  <span class="const token" data-binding="const-Expr.comp" data-verso-hover="568">.comp</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">.fn</span> <span class="const token" data-binding="const-mul" data-verso-hover="583">mul</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">![</span><span class="var token" data-binding="var-_uniq.298" data-verso-hover="581">f'</span><span class="unknown token" data-binding="">,</span><span class="var token" data-binding="var-_uniq.307" data-verso-hover="581">g'</span><span class="unknown token" data-binding="">]</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-12249" data-verso-hover="67">sorry_proof</span>
<span class="unknown token" data-binding=""></span></code><p>
                Lean uses <code>OfNat.ofNat n</code> to represent numerical constants for any type and <code>OfScientific.ofScientific</code> to represent numerical constants in scientific notation. We first define <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Constant" data-verso-hover="493">Constant</span></code> for both and then provide transformation rules.</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-12517">def</span> <span class="const token" data-binding="const-natConst" data-verso-hover="584">natConst</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Constant" data-verso-hover="493">Constant</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-12551">where</span>
  <span class="const token" data-binding="const-Constant.val" data-verso-hover="585">val</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span>
  <span class="const token" data-binding="const-Constant.name" data-verso-hover="489">name</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-ToString.toString" data-verso-hover="512">toString</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">n</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-12600">def</span> <span class="const token" data-binding="const-scientificConst" data-verso-hover="586">scientificConst</span> 
    <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.150" data-verso-hover="4">mantissa</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.152" data-verso-hover="587">exponentSign</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Bool" data-verso-hover="588">Bool</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.154" data-verso-hover="4">decimalExponent</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Constant" data-verso-hover="493">Constant</span> 
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-12700">where</span>
  <span class="const token" data-binding="const-Constant.val" data-verso-hover="585">val</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-OfScientific.ofScientific" data-verso-hover="589">OfScientific.ofScientific</span> <span class="var token" data-binding="var-_uniq.150" data-verso-hover="4">mantissa</span> <span class="var token" data-binding="var-_uniq.152" data-verso-hover="587">exponentSign</span> <span class="var token" data-binding="var-_uniq.154" data-verso-hover="4">decimalExponent</span>
  <span class="const token" data-binding="const-Constant.name" data-verso-hover="489">name</span> <span class="unknown token" data-binding="">:=</span> <span class="const token" data-binding="const-ToString.toString" data-verso-hover="512">toString</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-OfScientific.ofScientific" data-verso-hover="589">OfScientific.ofScientific</span> <span class="var token" data-binding="var-_uniq.150" data-verso-hover="4">mantissa</span> <span class="var token" data-binding="var-_uniq.152" data-verso-hover="587">exponentSign</span> <span class="var token" data-binding="var-_uniq.154" data-verso-hover="4">decimalExponent</span><span class="unknown token" data-binding="">)</span>

<span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.theorem-12878">theorem</span> <span class="const token" data-binding="const-compile.ofNat_rule" data-verso-hover="590">compile.ofNat_rule</span> 
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.334" data-verso-hover="4">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> 
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12932">fun</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.332" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-OfNat.ofNat" data-verso-hover="591">OfNat.ofNat</span> <span class="var token" data-binding="var-_uniq.334" data-verso-hover="4">i</span><span class="unknown token" data-binding="">)</span> 
  <span class="unknown token" data-binding="">=</span> 
  <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Expr.const" data-verso-hover="567">.const</span> <span class="var token" data-binding="var-_uniq.332" data-verso-hover="4">n</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-natConst" data-verso-hover="592">natConst</span> <span class="var token" data-binding="var-_uniq.334" data-verso-hover="4">i</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-13009" data-verso-hover="67">sorry_proof</span>

<span class="unknown token" data-binding="">@[</span><span class="unknown token" data-binding="">fun_trans</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.theorem-13035">theorem</span> <span class="const token" data-binding="const-compile.ofScientific_rule" data-verso-hover="593">compile.ofScientific_rule</span> <span class="unknown token" data-binding="">:</span> 
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-13083">fun</span> <span class="unknown token" data-binding="">_</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.380" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-OfScientific.ofScientific" data-verso-hover="589">OfScientific.ofScientific</span> <span class="var token" data-binding="var-_uniq.398" data-verso-hover="4">n</span> <span class="var token" data-binding="var-_uniq.415" data-verso-hover="587">b</span> <span class="var token" data-binding="var-_uniq.432" data-verso-hover="4">m</span><span class="unknown token" data-binding="">)</span> 
  <span class="unknown token" data-binding="">=</span> 
  <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Expr.const" data-verso-hover="567">.const</span> <span class="var token" data-binding="var-_uniq.380" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-scientificConst" data-verso-hover="594">scientificConst</span> <span class="var token" data-binding="var-_uniq.398" data-verso-hover="4">n</span> <span class="var token" data-binding="var-_uniq.415" data-verso-hover="587">b</span> <span class="var token" data-binding="var-_uniq.432" data-verso-hover="4">m</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="keyword token" data-binding="kw-occ-SciLean.termSorry_proof-13189" data-verso-hover="67">sorry_proof</span>
<span class="unknown token" data-binding=""></span></code><p>
                Let's test <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span></code> on a simple function of two arguments</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">(Expr.fn mul).comp
  ![Expr.const 2 (scientificConst 31415 true 4),
    (Expr.fn add).comp ![(Expr.fn add).comp ![Expr.var 2 0, Expr.var 2 1], Expr.const 2 (natConst 5)]] : Expr 2</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-13303">#check</span></span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-13320">fun</span> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="unknown token" data-binding="">3.1415</span> <span class="unknown token" data-binding="">*</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.15" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">0</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">+</span> <span class="unknown token" data-binding="">5</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> 
  <span class="keyword token" data-binding="kw-occ-SciLean.term_Rewrite_byAssuming__-13310">rewrite_by</span> <span class="tactic"><label for="tactic-state-9678144464106540174-13390-13399"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransConvStx-13390">fun_trans</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-9678144464106540174-13390-13399"><div class="tactic-state"><div class="goal"><span class="conclusion"><span class="prefix">| </span><span class="type">(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-mul" data-verso-hover="583">mul</span>).comp
  ![<span class="const token" data-binding="const-Expr.const" data-verso-hover="567">Expr.const</span> 2 (<span class="const token" data-binding="const-scientificConst" data-verso-hover="594">scientificConst</span> 31415 <span class="const token" data-binding="const-Bool.true" data-verso-hover="452">true</span> 4),
    (<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![<span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 0, <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 1], <span class="const token" data-binding="const-Expr.const" data-verso-hover="567">Expr.const</span> 2 (<span class="const token" data-binding="const-natConst" data-verso-hover="592">natConst</span> 5)]]</span></span></div></div></span>
<span class="unknown token" data-binding=""></span></code><div class="information">
                <pre>(Expr.fn mul).comp
  ![Expr.const 2 (scientificConst 31415 true 4),
    (Expr.fn add).comp ![(Expr.fn add).comp ![Expr.var 2 0, Expr.var 2 1], Expr.const 2 (natConst 5)]] : Expr 2
</pre></div>
              <p>
                We can see that <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span></code> has been completely eliminated.</p>
              <p>
                The last step of is to generate the corresponding C code for a given <code>(e : Expr r)</code>. To do that we need access the corresponding <code>ExprRepr r</code> and call <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr.toCCode" data-verso-hover="519">ExprRepr.toCCode</span></code>. Previously we have discussed that accessing the runtime representative with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Quot.unquot" data-verso-hover="559">Quot.unquot</span></code> is unsound therefore implementing <code>Expr.toCCode</code> has to be unsound too.</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.unsafe-14035">unsafe</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-14042">def</span> <span class="const token" data-binding="const-Expr.toCCode" data-verso-hover="595">Expr.toCCode</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5" data-verso-hover="596">e</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="var token" data-binding="var-_uniq.3" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7" data-verso-hover="514">name</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-String" data-verso-hover="28">String</span> <span class="unknown token" data-binding="">:=</span> 
  <span class="var token" data-binding="var-_uniq.5" data-verso-hover="596">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Quot.unquot" data-verso-hover="559">unquot</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCode" data-verso-hover="519">toCCode</span> <span class="var token" data-binding="var-_uniq.7" data-verso-hover="514">name</span>
<span class="unknown token" data-binding=""></span></code><code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">"float foo(float x0, float x1){\n  return mul(3.141500, add(add(x0, x1), 5));\n}"
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-14165">#eval</span></span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-14181">fun</span> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="unknown token" data-binding="">3.1415</span> <span class="unknown token" data-binding="">*</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.15" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">0</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.15" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">+</span> <span class="unknown token" data-binding="">5</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> 
  <span class="keyword token" data-binding="kw-occ-SciLean.term_Rewrite_byAssuming__-14171">rewrite_by</span> <span class="tactic"><label for="tactic-state-9678144464106540174-14251-14260"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransConvStx-14251">fun_trans</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-9678144464106540174-14251-14260"><div class="tactic-state"><div class="goal"><span class="conclusion"><span class="prefix">| </span><span class="type">(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-mul" data-verso-hover="583">mul</span>).comp
  ![<span class="const token" data-binding="const-Expr.const" data-verso-hover="567">Expr.const</span> 2 (<span class="const token" data-binding="const-scientificConst" data-verso-hover="594">scientificConst</span> 31415 <span class="const token" data-binding="const-Bool.true" data-verso-hover="452">true</span> 4),
    (<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![<span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 0, <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 1], <span class="const token" data-binding="const-Expr.const" data-verso-hover="567">Expr.const</span> 2 (<span class="const token" data-binding="const-natConst" data-verso-hover="592">natConst</span> 5)]]</span></span></div></div></span> <span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Expr.toCCode" data-verso-hover="595">toCCode</span> <span class="literal string token" data-binding="" data-verso-hover="597">"foo"</span>
<span class="unknown token" data-binding=""></span></code><div class="information">
                <pre>"float foo(float x0, float x1){\n  return mul(3.141500, add(add(x0, x1), 5));\n}"
</pre></div>
              </section>
            <section>
              <h3 id="Scientific-Computing-in-Lean---Function-Transformation--Expression-Compiler--Compiling-from-Lean-to-Expressions--Exercises">
                Exercises</h3>
              <ol start="1">
                <li>
                  <p>
                    Using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span></code> is not completely ergonomic. Define <code>compile1 : (Float → Float) → Expr 1</code>, <code>compile2 : (Float → Float → Float) → Expr 2</code>, ... . Mark these function with <code>@[simp]</code> attribute for <code>fun_trans</code> to automatically unfold them. For example, you should be able to able to write</p>
                  </li>
                </ol>
              <pre>#eval (compile2 (fun x y =&gt; (x + y) * (x + y))) 
      rewrite_by fun_trans |&gt;.toCCode "foo"
</pre><div class="collapsible" onclick="this.classList.toggle('expanded');">
                <div class="collapsible-header">
                  Solution</div>
                <div class="collapsible-content">
                  <code class="hl lean block" data-lean-context="examples"><span class="unknown token" data-binding="">@[</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Attr.simp-14842" data-verso-hover="186">simp</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.noncomputable-14848">noncomputable</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-14862">def</span> <span class="const token" data-binding="const-compile1" data-verso-hover="598">compile1</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="91">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">:=</span>
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-14920">fun</span> <span class="var token" data-binding="var-_uniq.28" data-verso-hover="599">x</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="unknown token" data-binding="">1</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="91">f</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.28" data-verso-hover="599">x</span> <span class="unknown token" data-binding="">0</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span>

<span class="unknown token" data-binding="">@[</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Attr.simp-14959" data-verso-hover="186">simp</span><span class="unknown token" data-binding="">]</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.noncomputable-14965">noncomputable</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-14979">def</span> <span class="const token" data-binding="const-compile2" data-verso-hover="600">compile2</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.70" data-verso-hover="601">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Expr" data-verso-hover="562">Expr</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">:=</span>
  <span class="const token" data-binding="const-compile" data-verso-hover="575">compile</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-15047">fun</span> <span class="var token" data-binding="var-_uniq.93" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="unknown token" data-binding="">2</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Float" data-verso-hover="27">Float</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.70" data-verso-hover="601">f</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.93" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">0</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.93" data-verso-hover="488">x</span> <span class="unknown token" data-binding="">1</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span>


<span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">"float foo1(float x0){\n  return mul(add(x0, x0), x0);\n}"
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-15091">#eval</span></span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-compile1" data-verso-hover="602">compile1</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-15108">fun</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="79">x</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.147" data-verso-hover="79">x</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="79">x</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.147" data-verso-hover="79">x</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> 
  <span class="keyword token" data-binding="kw-occ-SciLean.term_Rewrite_byAssuming__-15097">rewrite_by</span> 
    <span class="tactic"><label for="tactic-state-3191273881336009193-15150-15159"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransConvStx-15150">fun_trans</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-3191273881336009193-15150-15159"><div class="tactic-state"><div class="goal"><span class="conclusion"><span class="prefix">| </span><span class="type">(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-mul" data-verso-hover="583">mul</span>).comp ![(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![<span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 1 0, <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 1 0], <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 1 0]</span></span></div></div></span>
  <span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Quot.unquot" data-verso-hover="559">unquot</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCode" data-verso-hover="519">toCCode</span> <span class="literal string token" data-binding="" data-verso-hover="603">"foo1"</span>

<span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">"float foo2(float x0, float x1){\n  return mul(add(x0, x1), add(x0, x1));\n}"
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-15188">#eval</span></span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-compile2" data-verso-hover="604">compile2</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-15205">fun</span> <span class="var token" data-binding="var-_uniq.409" data-verso-hover="79">x</span> <span class="var token" data-binding="var-_uniq.412" data-verso-hover="79">y</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.409" data-verso-hover="79">x</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.412" data-verso-hover="79">y</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">*</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.409" data-verso-hover="79">x</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.412" data-verso-hover="79">y</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> 
  <span class="keyword token" data-binding="kw-occ-SciLean.term_Rewrite_byAssuming__-15194">rewrite_by</span> <span class="tactic"><label for="tactic-state-17929509393010337026-15250-15259"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransConvStx-15250">fun_trans</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-17929509393010337026-15250-15259"><div class="tactic-state"><div class="goal"><span class="conclusion"><span class="prefix">| </span><span class="type">(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-mul" data-verso-hover="583">mul</span>).comp ![(<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![<span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 0, <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 1], (<span class="const token" data-binding="const-Expr.fn" data-verso-hover="566">Expr.fn</span> <span class="const token" data-binding="const-add" data-verso-hover="508">add</span>).comp ![<span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 0, <span class="const token" data-binding="const-Expr.var" data-verso-hover="565">Expr.var</span> 2 1]]</span></span></div></div></span>
  <span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Quot.unquot" data-verso-hover="559">unquot</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-ExprRepr.toCCode" data-verso-hover="519">toCCode</span> <span class="literal string token" data-binding="" data-verso-hover="605">"foo2"</span>
<span class="unknown token" data-binding=""></span></code></div>
                </div>
              <ol start="2">
                <li>
                  <p>
                    Define function transformations for other operations like division, negation or special functions like <code>sin</code>, <code>cos</code>, <code>exp</code>, ..</p>
                  </li>
                <li>
                  <p>
                    Add support for infix notation for generated C code. </p>
                  </li>
                <li>
                  <p>
                    (very hard/research direction) Extend <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span></code> to support let bindings and add function transformation for let bindings. </p>
                  </li>
                </ol>
              <p>
                (Right now it is not clear to me how to do this.)</p>
              <ol start="5">
                <li>
                  <p>
                    (very hard/research direction) Generalize this approach to a function of arbitrary types.</p>
                  </li>
                </ol>
              <p>
                The main idea would be to modify the definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Function" data-verso-hover="483">Function</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExprRepr" data-verso-hover="511">ExprRepr</span></code> to the following</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.namespace-15879" data-verso-hover="34">namespace</span> <span class="unknown token" data-binding="">Generalization</span>
<span class="doc-comment token" data-binding="">/-- 
Structure representing primitive function of type `X 0 × ... × X (r-1) → Y`
-/</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-15992">structure</span> <span class="const token" data-binding="const-Generalization.Function" data-verso-hover="606">Function</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8" data-verso-hover="39">Y</span> <span class="unknown token" data-binding="">:</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-null-16054">where</span>
  <span class="const token" data-binding="const-Generalization.Function.val" data-verso-hover="608">val</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.2" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="607">Xs</span> <span class="var token" data-binding="var-_uniq.14" data-verso-hover="499">i</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="39">Y</span>
  <span class="const token" data-binding="const-Generalization.Function.name" data-verso-hover="609">name</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Lean.Name" data-verso-hover="610">Lean.Name</span>

<span class="doc-comment token" data-binding="">/-- Expression representing function of arity `r` with input types 
`X 0, ..., X (r-1)` and output type `Y`-/</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-16227" data-verso-hover="496">inductive</span> <span class="const token" data-binding="const-Generalization.ExprRepr" data-verso-hover="611">ExprRepr</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.506" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.511" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.506" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.514" data-verso-hover="39">Y</span> <span class="unknown token" data-binding="">:</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-16303" data-verso-hover="612">Type</span> <span class="unknown token" data-binding="">1</span> 
<span class="keyword token" data-binding="kw-occ-null-16311">where</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-Generalization.ExprRepr.var" data-verso-hover="613">var</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.521" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.525" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.521" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.527" data-verso-hover="499">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.521" data-verso-hover="4">r</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Generalization.ExprRepr" data-verso-hover="611">ExprRepr</span> <span class="var token" data-binding="var-_uniq.521" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.525" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.525" data-verso-hover="607">Xs</span> <span class="var token" data-binding="var-_uniq.527" data-verso-hover="499">i</span><span class="unknown token" data-binding="">)</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-Generalization.ExprRepr.fn" data-verso-hover="614">fn</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.534" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.538" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.534" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.540" data-verso-hover="39">Y</span> <span class="unknown token" data-binding="">:</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">}</span> 
       <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.543" data-verso-hover="615">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Generalization.Function" data-verso-hover="606">Function</span> <span class="var token" data-binding="var-_uniq.534" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.538" data-verso-hover="607">Xs</span> <span class="var token" data-binding="var-_uniq.540" data-verso-hover="39">Y</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Generalization.ExprRepr" data-verso-hover="611">ExprRepr</span> <span class="var token" data-binding="var-_uniq.534" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.538" data-verso-hover="607">Xs</span> <span class="var token" data-binding="var-_uniq.540" data-verso-hover="39">Y</span>
  <span class="unknown token" data-binding="">|</span> <span class="const token" data-binding="const-Generalization.ExprRepr.comp" data-verso-hover="616">comp</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.579" data-verso-hover="4">s</span> <span class="var token" data-binding="var-_uniq.581" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Nat" data-verso-hover="5">Nat</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.585" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.581" data-verso-hover="4">r</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.589" data-verso-hover="617">Ys</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.579" data-verso-hover="4">s</span> <span class="unknown token" data-binding="">→</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">}</span> <span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.591" data-verso-hover="39">Z</span> <span class="unknown token" data-binding="">:</span> <span class="sort token" data-binding="">Type</span><span class="unknown token" data-binding="">}</span>
         <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.594" data-verso-hover="618">f</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Generalization.ExprRepr" data-verso-hover="611">ExprRepr</span> <span class="var token" data-binding="var-_uniq.579" data-verso-hover="4">s</span> <span class="var token" data-binding="var-_uniq.589" data-verso-hover="617">Ys</span> <span class="var token" data-binding="var-_uniq.591" data-verso-hover="39">Z</span><span class="unknown token" data-binding="">)</span> 
         <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.600" data-verso-hover="619">gs</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.597" data-verso-hover="507">i</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Fin" data-verso-hover="54">Fin</span> <span class="var token" data-binding="var-_uniq.579" data-verso-hover="4">s</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">→</span> <span class="const token" data-binding="const-Generalization.ExprRepr" data-verso-hover="611">ExprRepr</span> <span class="var token" data-binding="var-_uniq.581" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.585" data-verso-hover="607">Xs</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.589" data-verso-hover="617">Ys</span> <span class="var token" data-binding="var-_uniq.597" data-verso-hover="507">i</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Generalization.ExprRepr" data-verso-hover="611">ExprRepr</span> <span class="var token" data-binding="var-_uniq.581" data-verso-hover="4">r</span> <span class="var token" data-binding="var-_uniq.585" data-verso-hover="607">Xs</span> <span class="var token" data-binding="var-_uniq.577" data-verso-hover="39">Y</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.end-16670" data-verso-hover="189">end</span> <span class="unknown token" data-binding="">Generalization</span>
<span class="unknown token" data-binding=""></span></code></section>
            </section>
          </section>
        </main></div>
    </body>
  </html>

