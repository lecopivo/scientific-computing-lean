<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Automatic Differentiation</title><link rel="stylesheet" href="../../book.css">
    <script>
      
function saveCheckboxesInit() {
  for (checkbox of document.querySelectorAll('#toc input[type="checkbox"]')) {
    const value = localStorage.getItem(checkbox.id);

    // Treat the ToC toggle specially, because it should always default to
    // closed on mobile-width screens but respect user preference on desktop-width.
    if (checkbox.id === "toggle-toc" && window.matchMedia("(max-width: 700px)").matches) {
        checkbox.checked = false;
    } else if (value === "true") {
        checkbox.checked = true;
    } else if (value === "false") {
        checkbox.checked = false;
    } // if not found, do nothing

    checkbox.addEventListener("change", persistCheckbox);
  }
}

function persistCheckbox() {
  const value = this.checked; // in a handler, 'this' is the element with the handler on it
  const id = this.id;
  localStorage.setItem(this.id, value ? "true" : "false");
}

window.addEventListener("DOMContentLoaded", saveCheckboxesInit);
</script>
    <script>
      const __versoSiteRoot = "./../../"</script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="../../static/katex/katex.min.js"></script>
    <script src="../../static/math.js"></script>
    <script src="../../static/print.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../-verso-js/popper.js"></script>
    <script src="../../-verso-js/tippy.js"></script>
    <link rel="stylesheet" href="../../static/colors.css">
    <link rel="stylesheet" href="../../static/theme.css">
    <link rel="stylesheet" href="../../static/print.css">
    <link rel="stylesheet" href="../../static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="../../static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="../../static/katex/katex.min.css">
    <link rel="stylesheet" href="../../-verso-css/tippy-border.css">
    <style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1rem;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: 0.1rem;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error {
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning {
  text-decoration-color: #efd871;
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color: #efd871;
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: #efd871;
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #efd871;
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40rem;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2rem;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1rem;
  height: 0.25rem;
  vertical-align: middle;
  width: 0.6rem;
  margin-left: 0.1rem;
  margin-right: 0.1rem;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5rem;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5rem;
}

.hl.lean .tactic-state details {
  padding-left: 0.5rem;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7rem;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6rem;
  height: 0.6rem;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .tactic-state .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  margin-left: 0.5rem;
  margin-top: 0.1rem;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses {
  display: table;
}

.hl.lean .tactic-state .hypothesis {
  display: table-row;
}

.hl.lean .tactic-state .hypothesis > * {
  display: table-cell;
}


.hl.lean .tactic-state .hypotheses .colon {
  text-align: center;
  min-width: 1rem;
}

.hl.lean .tactic-state .hypotheses .name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses .name,
.hl.lean .tactic-state .hypotheses .type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #efd871;
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}



.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
.namedocs {
  position: relative;
  border: solid 2px #99b3c0;
  background-color: #99b3c0;
  padding-left: 1px;
  padding-right: 1px;
  padding-bottom: 1px;
  padding-top: 1.5rem;
  margin-bottom: 1rem;
}

.namedocs .text {
  background-color: white;
  padding: 1.5rem;
  margin-top: 0.5rem;
}

.namedocs .text > pre {
  overflow-x: auto;
}

.namedocs .signature {
  font-family: var(--verso-code-font-family);
  font-size: larger;
  margin-top: 0 !important;
  margin-left: 1.5rem !important;
  margin-right: 1.5rem;
}

.namedocs .label {
  font-size: smaller;
  font-family: var(--verso-structure-font-family);
  position: absolute;
  right: 0.5rem;
  top: 0.5rem;
}

/* Sticking content into the right margin is not good on narrow screens,
   so move the label to the left to make space for the permalink widget. */

@media screen and (max-width: 700px) {
  .namedocs:has(.permalink-widget.block) .label {
    right: 1.5rem;
  }
}

.namedocs h1 {
  font-size: inherit;
  font-weight: bold;
}

.namedocs > .text .constructor {
  padding-left: 0.5rem;
  padding-top: 0;
  padding-right: 0;
  padding-bottom: 0;
  margin-top: 0.5rem;
  margin-bottom: 1.5rem;
}

.namedocs > .text .constructor::before {
  content: '| ';
  display: block;
  font-family: var(--verso-code-font-family);
  font-weight: bold;
  float: left;
  width: 0.5rem;
  white-space: pre;
}

.namedocs > .text .constructor .name-and-type {
  padding-left: 0.5rem;
  float: left;
  margin-top: 0;
}
.namedocs > .text .constructor .docs {
  clear: both;
  padding-left: 1rem;
}


.namedocs .methods td, .namedocs .fields td {
  vertical-align: top;
}
.namedocs .inheritance {
  vertical-align: top;
  font-size: smaller;
  font-family: var(--verso-structure-font-family);
}
.namedocs .inheritance ol {
  display: inline-block;
  margin: 0;
  padding: 0;
}
.namedocs .inheritance ol li {
  list-style-type: none;
  display: inline-block;
}
.namedocs .inheritance ol li::after {
  content: " > "
}
.namedocs .inheritance ol li:last-child::after {
  content: "";
}

.namedocs .extends {
  display: inline;
  margin: 0;
  padding: 0;
}

.namedocs .extends li {
  list-style-type: none;
  display: inline-block;
}

.namedocs .extends li label {
  padding-right: 1rem;
}

.namedocs .subdocs .name-and-type {
  font-size: 1rem;
  margin-left: 0;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs .subdocs .docs {
  margin-left: 1.5rem;
  margin-top: 0;
  margin-right: 0;
  margin-bottom: 0.5rem;
}

.namedocs:has(input[data-parent-idx]) [data-inherited-from] {
  transition-property: opacity, display;
  transition-duration: 0.4s;
  transition-behavior: allow-discrete;
  @starting-style { opacity: 0 !important; }
}
.namedocs:has(input[data-parent-idx="0"]) [data-inherited-from="0"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="0"]:checked) [data-inherited-from="0"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="0"]:checked):has(.inheritance[data-inherited-from="0"]:hover) [data-inherited-from]:not([data-inherited-from="0"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="1"]) [data-inherited-from="1"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="1"]:checked) [data-inherited-from="1"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="1"]:checked):has(.inheritance[data-inherited-from="1"]:hover) [data-inherited-from]:not([data-inherited-from="1"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="2"]) [data-inherited-from="2"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="2"]:checked) [data-inherited-from="2"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="2"]:checked):has(.inheritance[data-inherited-from="2"]:hover) [data-inherited-from]:not([data-inherited-from="2"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="3"]) [data-inherited-from="3"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="3"]:checked) [data-inherited-from="3"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="3"]:checked):has(.inheritance[data-inherited-from="3"]:hover) [data-inherited-from]:not([data-inherited-from="3"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="4"]) [data-inherited-from="4"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="4"]:checked) [data-inherited-from="4"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="4"]:checked):has(.inheritance[data-inherited-from="4"]:hover) [data-inherited-from]:not([data-inherited-from="4"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="5"]) [data-inherited-from="5"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="5"]:checked) [data-inherited-from="5"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="5"]:checked):has(.inheritance[data-inherited-from="5"]:hover) [data-inherited-from]:not([data-inherited-from="5"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="6"]) [data-inherited-from="6"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="6"]:checked) [data-inherited-from="6"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="6"]:checked):has(.inheritance[data-inherited-from="6"]:hover) [data-inherited-from]:not([data-inherited-from="6"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="7"]) [data-inherited-from="7"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="7"]:checked) [data-inherited-from="7"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="7"]:checked):has(.inheritance[data-inherited-from="7"]:hover) [data-inherited-from]:not([data-inherited-from="7"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="8"]) [data-inherited-from="8"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="8"]:checked) [data-inherited-from="8"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="8"]:checked):has(.inheritance[data-inherited-from="8"]:hover) [data-inherited-from]:not([data-inherited-from="8"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="9"]) [data-inherited-from="9"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="9"]:checked) [data-inherited-from="9"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="9"]:checked):has(.inheritance[data-inherited-from="9"]:hover) [data-inherited-from]:not([data-inherited-from="9"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="10"]) [data-inherited-from="10"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="10"]:checked) [data-inherited-from="10"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="10"]:checked):has(.inheritance[data-inherited-from="10"]:hover) [data-inherited-from]:not([data-inherited-from="10"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="11"]) [data-inherited-from="11"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="11"]:checked) [data-inherited-from="11"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="11"]:checked):has(.inheritance[data-inherited-from="11"]:hover) [data-inherited-from]:not([data-inherited-from="11"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="12"]) [data-inherited-from="12"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="12"]:checked) [data-inherited-from="12"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="12"]:checked):has(.inheritance[data-inherited-from="12"]:hover) [data-inherited-from]:not([data-inherited-from="12"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="13"]) [data-inherited-from="13"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="13"]:checked) [data-inherited-from="13"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="13"]:checked):has(.inheritance[data-inherited-from="13"]:hover) [data-inherited-from]:not([data-inherited-from="13"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="14"]) [data-inherited-from="14"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="14"]:checked) [data-inherited-from="14"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="14"]:checked):has(.inheritance[data-inherited-from="14"]:hover) [data-inherited-from]:not([data-inherited-from="14"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="15"]) [data-inherited-from="15"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="15"]:checked) [data-inherited-from="15"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="15"]:checked):has(.inheritance[data-inherited-from="15"]:hover) [data-inherited-from]:not([data-inherited-from="15"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="16"]) [data-inherited-from="16"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="16"]:checked) [data-inherited-from="16"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="16"]:checked):has(.inheritance[data-inherited-from="16"]:hover) [data-inherited-from]:not([data-inherited-from="16"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="17"]) [data-inherited-from="17"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="17"]:checked) [data-inherited-from="17"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="17"]:checked):has(.inheritance[data-inherited-from="17"]:hover) [data-inherited-from]:not([data-inherited-from="17"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="18"]) [data-inherited-from="18"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="18"]:checked) [data-inherited-from="18"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="18"]:checked):has(.inheritance[data-inherited-from="18"]:hover) [data-inherited-from]:not([data-inherited-from="18"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="19"]) [data-inherited-from="19"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="19"]:checked) [data-inherited-from="19"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="19"]:checked):has(.inheritance[data-inherited-from="19"]:hover) [data-inherited-from]:not([data-inherited-from="19"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="20"]) [data-inherited-from="20"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="20"]:checked) [data-inherited-from="20"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="20"]:checked):has(.inheritance[data-inherited-from="20"]:hover) [data-inherited-from]:not([data-inherited-from="20"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="21"]) [data-inherited-from="21"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="21"]:checked) [data-inherited-from="21"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="21"]:checked):has(.inheritance[data-inherited-from="21"]:hover) [data-inherited-from]:not([data-inherited-from="21"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="22"]) [data-inherited-from="22"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="22"]:checked) [data-inherited-from="22"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="22"]:checked):has(.inheritance[data-inherited-from="22"]:hover) [data-inherited-from]:not([data-inherited-from="22"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="23"]) [data-inherited-from="23"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="23"]:checked) [data-inherited-from="23"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="23"]:checked):has(.inheritance[data-inherited-from="23"]:hover) [data-inherited-from]:not([data-inherited-from="23"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="24"]) [data-inherited-from="24"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="24"]:checked) [data-inherited-from="24"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="24"]:checked):has(.inheritance[data-inherited-from="24"]:hover) [data-inherited-from]:not([data-inherited-from="24"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="25"]) [data-inherited-from="25"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="25"]:checked) [data-inherited-from="25"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="25"]:checked):has(.inheritance[data-inherited-from="25"]:hover) [data-inherited-from]:not([data-inherited-from="25"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="26"]) [data-inherited-from="26"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="26"]:checked) [data-inherited-from="26"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="26"]:checked):has(.inheritance[data-inherited-from="26"]:hover) [data-inherited-from]:not([data-inherited-from="26"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="27"]) [data-inherited-from="27"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="27"]:checked) [data-inherited-from="27"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="27"]:checked):has(.inheritance[data-inherited-from="27"]:hover) [data-inherited-from]:not([data-inherited-from="27"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="28"]) [data-inherited-from="28"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="28"]:checked) [data-inherited-from="28"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="28"]:checked):has(.inheritance[data-inherited-from="28"]:hover) [data-inherited-from]:not([data-inherited-from="28"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="29"]) [data-inherited-from="29"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="29"]:checked) [data-inherited-from="29"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="29"]:checked):has(.inheritance[data-inherited-from="29"]:hover) [data-inherited-from]:not([data-inherited-from="29"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="30"]) [data-inherited-from="30"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="30"]:checked) [data-inherited-from="30"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="30"]:checked):has(.inheritance[data-inherited-from="30"]:hover) [data-inherited-from]:not([data-inherited-from="30"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="31"]) [data-inherited-from="31"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="31"]:checked) [data-inherited-from="31"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="31"]:checked):has(.inheritance[data-inherited-from="31"]:hover) [data-inherited-from]:not([data-inherited-from="31"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="32"]) [data-inherited-from="32"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="32"]:checked) [data-inherited-from="32"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="32"]:checked):has(.inheritance[data-inherited-from="32"]:hover) [data-inherited-from]:not([data-inherited-from="32"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="33"]) [data-inherited-from="33"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="33"]:checked) [data-inherited-from="33"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="33"]:checked):has(.inheritance[data-inherited-from="33"]:hover) [data-inherited-from]:not([data-inherited-from="33"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="34"]) [data-inherited-from="34"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="34"]:checked) [data-inherited-from="34"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="34"]:checked):has(.inheritance[data-inherited-from="34"]:hover) [data-inherited-from]:not([data-inherited-from="34"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="35"]) [data-inherited-from="35"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="35"]:checked) [data-inherited-from="35"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="35"]:checked):has(.inheritance[data-inherited-from="35"]:hover) [data-inherited-from]:not([data-inherited-from="35"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="36"]) [data-inherited-from="36"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="36"]:checked) [data-inherited-from="36"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="36"]:checked):has(.inheritance[data-inherited-from="36"]:hover) [data-inherited-from]:not([data-inherited-from="36"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="37"]) [data-inherited-from="37"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="37"]:checked) [data-inherited-from="37"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="37"]:checked):has(.inheritance[data-inherited-from="37"]:hover) [data-inherited-from]:not([data-inherited-from="37"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="38"]) [data-inherited-from="38"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="38"]:checked) [data-inherited-from="38"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="38"]:checked):has(.inheritance[data-inherited-from="38"]:hover) [data-inherited-from]:not([data-inherited-from="38"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="39"]) [data-inherited-from="39"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="39"]:checked) [data-inherited-from="39"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="39"]:checked):has(.inheritance[data-inherited-from="39"]:hover) [data-inherited-from]:not([data-inherited-from="39"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="40"]) [data-inherited-from="40"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="40"]:checked) [data-inherited-from="40"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="40"]:checked):has(.inheritance[data-inherited-from="40"]:hover) [data-inherited-from]:not([data-inherited-from="40"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="41"]) [data-inherited-from="41"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="41"]:checked) [data-inherited-from="41"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="41"]:checked):has(.inheritance[data-inherited-from="41"]:hover) [data-inherited-from]:not([data-inherited-from="41"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="42"]) [data-inherited-from="42"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="42"]:checked) [data-inherited-from="42"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="42"]:checked):has(.inheritance[data-inherited-from="42"]:hover) [data-inherited-from]:not([data-inherited-from="42"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="43"]) [data-inherited-from="43"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="43"]:checked) [data-inherited-from="43"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="43"]:checked):has(.inheritance[data-inherited-from="43"]:hover) [data-inherited-from]:not([data-inherited-from="43"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="44"]) [data-inherited-from="44"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="44"]:checked) [data-inherited-from="44"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="44"]:checked):has(.inheritance[data-inherited-from="44"]:hover) [data-inherited-from]:not([data-inherited-from="44"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="45"]) [data-inherited-from="45"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="45"]:checked) [data-inherited-from="45"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="45"]:checked):has(.inheritance[data-inherited-from="45"]:hover) [data-inherited-from]:not([data-inherited-from="45"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="46"]) [data-inherited-from="46"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="46"]:checked) [data-inherited-from="46"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="46"]:checked):has(.inheritance[data-inherited-from="46"]:hover) [data-inherited-from]:not([data-inherited-from="46"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="47"]) [data-inherited-from="47"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="47"]:checked) [data-inherited-from="47"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="47"]:checked):has(.inheritance[data-inherited-from="47"]:hover) [data-inherited-from]:not([data-inherited-from="47"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="48"]) [data-inherited-from="48"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="48"]:checked) [data-inherited-from="48"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="48"]:checked):has(.inheritance[data-inherited-from="48"]:hover) [data-inherited-from]:not([data-inherited-from="48"]) {
  opacity: 0.5;
}
.namedocs:has(input[data-parent-idx="49"]) [data-inherited-from="49"] {
  display: none;
  opacity: 0;
}
.namedocs:has(input[data-parent-idx="49"]:checked) [data-inherited-from="49"] {
  display: table-row;
  transform: none;
  opacity: 1;
}
.namedocs:has(input[data-parent-idx="49"]:checked):has(.inheritance[data-inherited-from="49"]:hover) [data-inherited-from]:not([data-inherited-from="49"]) {
  opacity: 0.5;
}
</style><style>.solution {
  padding: 1.5em;
  border: 1px solid #98B2C0;
  border-radius: 0.5em;
  margin-bottom: 0.75em;
  margin-top: 0.75em;
  clear: both; /* Don't overlap margin notes with solutions */
}
.solution p:last-child {margin-bottom:0;}
.solution .description::before {
  content: "";
}
.solution[open] .description {
  margin-bottom: 1em;
}
.solution .description {
  font-style: italic;
  font-family: var(--verso-structure-font-family);
}
.solution .hl.lean.block {
  overflow-x: auto;
}
</style><style>
div.TODO {
  border: 5px solid red;
  position: relative;
}
div.TODO::before {
  content: "TODO";
  position: absolute;
  top: 0;
  right: 0;
  color: red;
  font-size: large;
  font-weight: bold;
  transform: rotate(-90deg) translate(-2em);
}
</style><style>.foldable {
  padding: 1.5em;
  border: 1px solid #98B2C0;
  border-radius: 0.5em;
  margin-bottom: 0.75em;
  margin-top: 0.75em;
  clear: both; /* Don't overlap margin notes with foldables */
}
.foldable p:last-child {margin-bottom:0;}
.foldable .description::before {
  content: "";
}
.foldable[open] .description {
  margin-bottom: 1em;
}
.foldable .description {
  font-style: italic;
  font-family: var(--verso-structure-font-family);
}
.foldable .hl.lean.block {
  overflow-x: auto;
}
</style><script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let siteRoot = typeof __versoSiteRoot !== 'undefined' ? __versoSiteRoot : "/";
    fetch(siteRoot + "-verso-docs.json").then((resp) => resp.json()).then((versoDocData) => {

      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        theme: "lean",
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        ignoreAttributes: true,
        onShow(inst) {
          if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          content.className = "hl lean";
          content.style.display = "block";
          content.style.maxHeight = "300px";
          content.style.overflowY = "auto";
          content.style.overflowX = "hidden";
          const hoverId = tgt.dataset.versoHover;
          const hoverInfo = tgt.querySelector(".hover-info");
          if (hoverId) { // Docstrings from the table
            // TODO stop doing an implicit conversion from string to number here
            let data = versoDocData[hoverId];
            if (data) {
              const info = document.createElement("span");
              info.className = "hover-info";
              info.style.display = "block";
              info.innerHTML = data;
              content.appendChild(info);
              /* Render docstrings - TODO server-side */
              if ('undefined' !== typeof marked) {
                  for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                      const str = d.innerText;
                      const html = marked.parse(str);
                      const rendered = document.createElement("div");
                      rendered.classList.add("docstring");
                      rendered.innerHTML = html;
                      d.parentNode.replaceChild(rendered, d);
                  }
              }
            } else {
              content.innerHTML = "Failed to load doc ID: " + hoverId;
            }
          } else if (hoverInfo) { // The inline info, still used for compiler messages
            content.appendChild(hoverInfo.cloneNode(true));
          }
          return content;
        }
      };

      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      addTippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token', {theme: 'lean'});
      addTippy('.hl.lean .has-info.warning', {theme: 'warning message'});
      addTippy('.hl.lean .has-info.info', {theme: 'info message'});
      addTippy('.hl.lean .has-info.error', {theme: 'error message'});

      tippy('.hl.lean .tactic', {
        allowHtml: true,
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        theme: "tactic",
        placement: 'bottom-start',
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
  });
}
</script>
    </head>
  <body>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc" checked="checked"><div class="first">
          <a href="../../" id="logo"><img src="../../static/lean_logo.svg"></a><nav id="local-buttons">
            <a class="local-button active" href="../Symbolic-Differentiation/#Scientific-Computing-in-Lean--Differentiation--Symbolic-Differentiation" rel="prev" title="2.1. Symbolic Differentiation"><span class="arrow">←</span><span class="where">Prev</span></a><a class="local-button active" href="../#Scientific-Computing-in-Lean--Differentiation" title="2. Differentiation"><span class="arrow">↑</span><span class="where">Up</span></a><a class="local-button active" href="../Function-Transformation/#Scientific-Computing-in-Lean--Differentiation--Function-Transformation" rel="next" title="2.3. Function Transformation"><span class="where">Next</span><span class="arrow">→</span></a></nav>
          <div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class=""><a href="../../">Scientific Computing in Lean</a></span></div>
              <table><tr class="numbered"><td class="num">1.</td><td><a href="../../Working-with-Arrays/#Scientific-Computing-in-Lean--Working-with-Arrays">Working with Arrays</a></td></tr><tr class="current numbered"><td class="num">2.</td><td><a href="../#Scientific-Computing-in-Lean--Differentiation">Differentiation</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="../../Miscellaneous/#Scientific-Computing-in-Lean--Miscellaneous">Miscellaneous</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Scientific-Computing-in-Lean--Differentiation" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Scientific-Computing-in-Lean--Differentiation"></label><span class="number">2.</span> <span class=""><a href="../#Scientific-Computing-in-Lean--Differentiation">Differentiation</a></span></div>
              <table><tr class="numbered"><td class="num">2.1.</td><td><a href="../Symbolic-Differentiation/#Scientific-Computing-in-Lean--Differentiation--Symbolic-Differentiation">Symbolic Differentiation</a></td></tr><tr class="current numbered"><td class="num">2.2.</td><td><a href="#Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation">Automatic Differentiation</a></td></tr><tr class="numbered"><td class="num">2.3.</td><td><a href="../Function-Transformation/#Scientific-Computing-in-Lean--Differentiation--Function-Transformation">Function Transformation</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation" checked="checked"></label><span class="number">2.2.</span> <span class="current"><a href="#Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation">Automatic Differentiation</a></span></div>
              <table><tr class="numbered"><td class="num">2.2.1.</td><td><a href="#Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Forward-Mode">Forward Mode</a></td></tr><tr class="numbered"><td class="num">2.2.2.</td><td><a href="#Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Reverse-Mode">Reverse Mode</a></td></tr></table></div>
            </div>
          </div>
        <div class="last"></div>
        </nav>
      <main><section>
          <h1>
            2.2. Automatic Differentiation</h1>
          <p>
            In scientific computing a common requirement is to compute derivatives of a program. The important requirement is that the resulting program computing the derivative should be efficient. The problem with symbolic differentiation is that it can produce expressions which are really inefficient. So called <strong>automatic differentiation</strong> addresses this issue an computes derivatives that are also efficient to compute.</p>
          <p>
            Let's have a look how symbolic differentiation can produce large expressions.</p>
          <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-785" data-verso-hover="162">open</span> <span class="unknown token" data-binding="">SciLean</span> <span class="unknown token" data-binding="">Scalar</span>
<span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">fun x =&gt;
  let y := x * x * x * x * x * x * x;
  let y_1 := x * x * x * x * x * x;
  let y_2 := x * x * x * x * x;
  let y_3 := x * x * x * x;
  let y_4 := x * x * x;
  let y_5 := x * x;
  let dy := x + x;
  let dy := y_5 + dy * x;
  let dy := y_4 + dy * x;
  let dy := y_3 + dy * x;
  let dy := y_2 + dy * x;
  let dy := y_1 + dy * x;
  y + dy * x : ℝ → ℝ</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-805">#check</span></span> <span class="unknown token" data-binding="">∂!</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.6" data-verso-hover="177">x</span>
<span class="unknown token" data-binding=""></span></code><p>
            The last example, symbolic differentiation takes and expression with 9 mulplications and produces an expression with 27 multiplications and 7 additions.</p>
          <p>
            If we instead use forward mode derivative(one type of automatic differentiation which we will explain in a moment)</p>
          <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">fun x dx =&gt;
  let zdz := x * x;
  let zdz_1 := x * dx + dx * x;
  let zdz_2 := zdz * x;
  let zdz := zdz * dx + zdz_1 * x;
  let zdz_3 := zdz_2 * x;
  let zdz := zdz_2 * dx + zdz * x;
  let zdz_4 := zdz_3 * x;
  let zdz := zdz_3 * dx + zdz * x;
  let zdz_5 := zdz_4 * x;
  let zdz := zdz_4 * dx + zdz * x;
  let zdz_6 := zdz_5 * x;
  let zdz := zdz_5 * dx + zdz * x;
  let zdz_7 := zdz_6 * x;
  let zdz := zdz_6 * dx + zdz * x;
  (zdz_7, zdz) : ℝ → ℝ → ℝ × ℝ</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-1140">#check</span></span> <span class="unknown token" data-binding="">∂&gt;!</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">*</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">x</span>
<span class="unknown token" data-binding=""></span></code><p>
            we obtain 21 multiplications and 7 additions.</p>
          <p>
            The difference might not seems to big but if you look at the shape of the result you can see that the the expression reulting from <code>∂</code> contains a big triangular block of multiplications whose size(in terms of multiplications) grows quadratically in the number of multiplications in the original expression. On the other hand when we use <code>∂&gt;</code>, for every multiplication in the original expression we obtain one line with <code>ydy * x</code> and one line with <code>dx * ydy_i + ydy * dx</code>.</p>
          <section>
            <h2 id="Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Forward-Mode">
              2.2.1. Forward Mode</h2>
            <p>
              The issue with symbolic differentiation is that the chain rule</p>
            <p>
              $$(f\circ g)'(x) = f'(g(x)) g'(x)
$$</p>
            <p>
              repeats \(g\) on the right hand side twice which can lead to doubling of computation everytime we apply chainrule.</p>
            <p>
              The remedy to this problem is to introduce forward mode derivative \( \overrightarrow{\partial} \)</p>
            <p>
              $$\overrightarrow{\partial} f (x,dx) = (f(x), f'(x) dx)
$$</p>
            <p>
              The motivation is that the forward mode derivative computes the value \( f(x) \) and the derivative \( f'(x) dx \) once and at the same time. Both values then can be comnsumed by subsequent computation without ever evaluating \(f\) again. The chain rule for forward mode derivative is</p>
            <p>
              $$\overrightarrow{\partial} \left( f \circ g \right) =  \overrightarrow{\partial} f  \circ  \overrightarrow{\partial} g
$$</p>
            <p>
              which does not suffer from the problem of repeating \( g \) twice and thus not potentially double the computation.</p>
            <p>
              In SciLean, the forward mode derivative is <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-SciLean.fwdFDeriv" data-verso-hover="299">fwdFDeriv</span></code> which has notaion <code>∂&gt;</code>. It is defined as</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.variable-2875" data-verso-hover="49">variable</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span> <span class="unknown token" data-binding="">→</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span>
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span><span class="unknown token" data-binding="">)</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-2976">example</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span><span class="unknown token" data-binding="">,</span> <span class="unknown token" data-binding="">∂</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-9902250518545601545-3023-3025"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-3023" data-verso-hover="67">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-9902250518545601545-3023-3025"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∂&gt; <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span><span class="const token" data-binding="const-Eq" data-verso-hover="69"> = </span>(<span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span>, (∂ <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span>) <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span>)</span></span></span></span></span> <span class="tactic"><label for="tactic-state-7-3026-3029"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRfl-3026" data-verso-hover="215">rfl</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-3026-3029"><span class="tactic-state">All goals completed! 🐙</span></span>
<span class="unknown token" data-binding=""></span></code><p>
              In Lean notation the chain rule can be writen as</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-3091">example</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="unknown token" data-binding="">∘</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span><span class="unknown token" data-binding="">)</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span><span class="unknown token" data-binding="">)</span>
          <span class="unknown token" data-binding="">=</span>
          <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-3145" data-verso-hover="81">let</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.684" data-verso-hover="177">y</span><span class="unknown token" data-binding="">,</span><span class="var token" data-binding="var-_uniq.685" data-verso-hover="177">dy</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span><span class="unknown token" data-binding="">)</span>
          <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.684" data-verso-hover="177">y</span> <span class="var token" data-binding="var-_uniq.685" data-verso-hover="177">dy</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-10690969752700066152-3200-3202"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-3200" data-verso-hover="67">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-10690969752700066152-3200-3202"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∂&gt; (<span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span><span class="const token" data-binding="const-Function.comp" data-verso-hover="302"> ∘ </span><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span>) <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span><span class="const token" data-binding="const-Eq" data-verso-hover="69"> =
  </span><span class="keyword token" data-binding="">match</span> ∂&gt; <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span> <span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span> <span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span> <span class="keyword token" data-binding="">with</span>
  | (<span class="var token" data-binding="var-_uniq.5074" data-verso-hover="177">y</span>, <span class="var token" data-binding="var-_uniq.5075" data-verso-hover="177">dy</span>) =&gt; ∂&gt; <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.5058" data-verso-hover="177">y</span> <span class="var token" data-binding="var-_uniq.5059" data-verso-hover="177">dy</span></span></span></span></span></span>
  <span class="tactic"><label for="tactic-state-7-3205-3233"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransTacStx-3205">fun_trans</span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Function.comp_def" data-verso-hover="303">Function.comp_def</span><span class="unknown token" data-binding="">]</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-3205-3233"><span class="tactic-state">All goals completed! 🐙</span></span>
<span class="unknown token" data-binding=""></span></code><p>
              Alternativelly, when we use the notation <code>↿f</code> that uncurries any function we can write the chain rule</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-3350">example</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">↿</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span> <span class="unknown token" data-binding="">∘</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span>
          <span class="unknown token" data-binding="">=</span>
          <span class="unknown token" data-binding="">↿</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">∘</span> <span class="unknown token" data-binding="">↿</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂&gt;</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-2114170483416481786-3433-3435"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-3433" data-verso-hover="67">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-2114170483416481786-3433-3435"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Function.HasUncurry.uncurry" data-verso-hover="304">↿</span>(∂&gt; <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span><span class="const token" data-binding="const-Function.comp" data-verso-hover="302"> ∘ </span><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span>)<span class="const token" data-binding="const-Eq" data-verso-hover="69"> = </span><span class="const token" data-binding="const-Function.HasUncurry.uncurry" data-verso-hover="304">↿</span>(∂&gt; <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span>)<span class="const token" data-binding="const-Function.comp" data-verso-hover="302"> ∘ </span><span class="const token" data-binding="const-Function.HasUncurry.uncurry" data-verso-hover="304">↿</span>(∂&gt; <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span>)</span></span></span></span></span>
  <span class="tactic"><label for="tactic-state-7-3438-3494"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransTacStx-3438">fun_trans</span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Function.comp_def" data-verso-hover="303">Function.comp_def</span><span class="unknown token" data-binding="">,</span><span class="const token" data-binding="const-Function.HasUncurry.uncurry" data-verso-hover="304">Function.HasUncurry.uncurry</span><span class="unknown token" data-binding="">]</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-3438-3494"><span class="tactic-state">All goals completed! 🐙</span></span>
<span class="unknown token" data-binding=""></span></code><p>
              In SciLean it is the theorem <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">@</span><span class="const token" data-binding="const-SciLean.fwdFDeriv.comp_rule" data-verso-hover="305">SciLean.fwdFDeriv.comp_rule</span></code>.</p>
            <section>
              <h3 id="Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Forward-Mode--autodiff-vs-fun_trans">
                2.2.1.1. autodiff vs fun_trans</h3>
              <p>
                So far we have been using the tactic <code>fun_trans</code> to compute derivatives. You might have notices that <code>fun_trans</code> removes all let bindings from the expression. For example</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">fun x =&gt; x * x + (x + x) * x : ℝ → ℝ</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-3801">#check</span></span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-3824" data-verso-hover="81">let</span> <span class="var token" data-binding="var-_uniq.858" data-verso-hover="177">y</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span><span class="unknown token" data-binding="">*</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span><span class="unknown token" data-binding="">;</span> <span class="var token" data-binding="var-_uniq.858" data-verso-hover="177">y</span><span class="unknown token" data-binding="">*</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-SciLean.term_Rewrite_byAssuming__-3808">rewrite_by</span> <span class="tactic"><label for="tactic-state-4176057371040669655-3854-3866"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.Conv.unfold-3854" data-verso-hover="258">unfold</span> <span class="const token" data-binding="const-deriv" data-verso-hover="190">deriv</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-4176057371040669655-3854-3866"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">| </span><span class="type"><span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span> =&gt;
  (∂ (<span class="var token" data-binding="var-_uniq.15431" data-verso-hover="177">x</span>:=<span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span>),
      <span class="keyword token" data-binding="">let</span> <span class="var token" data-binding="var-_uniq.15445" data-verso-hover="177">y</span> := <span class="var token" data-binding="var-_uniq.15431" data-verso-hover="177">x</span><span class="const token" data-binding="const-HMul.hMul" data-verso-hover="140"> * </span><span class="var token" data-binding="var-_uniq.15431" data-verso-hover="177">x</span>;
      <span class="var token" data-binding="var-_uniq.15445" data-verso-hover="177">y</span><span class="const token" data-binding="const-HMul.hMul" data-verso-hover="140"> * </span><span class="var token" data-binding="var-_uniq.15431" data-verso-hover="177">x</span>)
    1</span></span></span></span></span><span class="unknown token" data-binding="">;</span> <span class="tactic"><label for="tactic-state-429892963200138472-3868-3877"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransConvStx-3868">fun_trans</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-429892963200138472-3868-3877"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">| </span><span class="type"><span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span> =&gt; <span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span><span class="const token" data-binding="const-HMul.hMul" data-verso-hover="140"> * </span><span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span><span class="const token" data-binding="const-HAdd.hAdd" data-verso-hover="143"> + </span>(<span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span><span class="const token" data-binding="const-HAdd.hAdd" data-verso-hover="143"> + </span><span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span>)<span class="const token" data-binding="const-HMul.hMul" data-verso-hover="140"> * </span><span class="var token" data-binding="var-_uniq.15428" data-verso-hover="177">x</span></span></span></span></span></span>
<span class="unknown token" data-binding=""></span></code><p>
                we can alternativelly use <code>autodiff</code> tactic</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">fun x =&gt;
  let y := x * x;
  let dy := x + x;
  let dz := y + dy * x;
  dz : ℝ → ℝ</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.check-3960">#check</span></span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-3983" data-verso-hover="81">let</span> <span class="var token" data-binding="var-_uniq.858" data-verso-hover="177">y</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span><span class="unknown token" data-binding="">*</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span><span class="unknown token" data-binding="">;</span> <span class="var token" data-binding="var-_uniq.858" data-verso-hover="177">y</span><span class="unknown token" data-binding="">*</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="177">x</span><span class="unknown token" data-binding="">)</span> <span class="keyword token" data-binding="kw-occ-SciLean.term_Rewrite_byAssuming__-3967">rewrite_by</span> <span class="tactic"><label for="tactic-state-6362049575824314653-4013-4021"><span class="keyword token" data-binding="kw-occ-SciLean.Tactic.lautodiffConvStx-4013">autodiff</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-6362049575824314653-4013-4021"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">| </span><span class="type"><span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.18055" data-verso-hover="177">x</span> =&gt;
  <span class="keyword token" data-binding="">let</span> <span class="var token" data-binding="var-_uniq.18071" data-verso-hover="177">y</span> := <span class="var token" data-binding="var-_uniq.18055" data-verso-hover="177">x</span><span class="const token" data-binding="const-HMul.hMul" data-verso-hover="140"> * </span><span class="var token" data-binding="var-_uniq.18055" data-verso-hover="177">x</span>;
  <span class="keyword token" data-binding="">let</span> <span class="var token" data-binding="var-_uniq.18086" data-verso-hover="177">dy</span> := <span class="var token" data-binding="var-_uniq.18055" data-verso-hover="177">x</span><span class="const token" data-binding="const-HAdd.hAdd" data-verso-hover="143"> + </span><span class="var token" data-binding="var-_uniq.18055" data-verso-hover="177">x</span>;
  <span class="keyword token" data-binding="">let</span> <span class="var token" data-binding="var-_uniq.18100" data-verso-hover="177">dz</span> := <span class="var token" data-binding="var-_uniq.18071" data-verso-hover="177">y</span><span class="const token" data-binding="const-HAdd.hAdd" data-verso-hover="143"> + </span><span class="var token" data-binding="var-_uniq.18086" data-verso-hover="177">dy</span><span class="const token" data-binding="const-HMul.hMul" data-verso-hover="140"> * </span><span class="var token" data-binding="var-_uniq.18055" data-verso-hover="177">x</span>;
  <span class="var token" data-binding="var-_uniq.18100" data-verso-hover="177">dz</span></span></span></span></span></span>
<span class="unknown token" data-binding=""></span></code><p>
                The tactic <code>autodiff</code> behaves very similarly to <code>fun_trans</code> but it carefully handled let bindings which is important for generating efficient code. Internally it uses a slightly modified version of Lean's simplifier and carefully configured <code>fun_trans</code> such that it handles let bindings more carefully and efficiently.</p>
              <p>
                From now one, the rule of thumb it to use <code>fun_trans</code> if you do not care about generating efficient code and want to just prove something using derivatives and to use <code>autodiff</code> when you care about the efficiency of the resulting code.</p>
              <p>
                You might have noticed that let bindings are preserved when using <code>∂!</code> notation. This is because <code>∂!</code> is using the tactic <code>autodiff</code> instead of <code>fun_trans</code>.</p>
              <p>
                Note that when you want to compute efficient derivatives you have to use <code>autodiff</code> <strong>and</strong> forward mode derivative <code>∂&gt;</code>. Using only one of them will not yield the most efficient code.</p>
              </section>
            <section>
              <h3 id="Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Forward-Mode--Relation-to-Dual-Numbers">
                2.2.1.2. Relation to Dual Numbers</h3>
              <p>
                One common explanation of forward mode derivative is through dual numbers \(a + \epsilon b \). Similarly to complex numbers \( \mathbb{C}\), which extend reals numbers with complex unit \(i\) that squares to negative one, \(i^2 = -1\), the dual numbers \( \overline{\mathbb{R}}\) extend real numbers with \(\epsilon\) that squares to zero, \(\epsilon^2 = 0\).</p>
              <p>
                We can add and multiply two dual numbers</p>
              <p>
                $$\begin{align}
(a + \epsilon b) + (c + \epsilon d) &= ((a + c) + \epsilon (b + d)) \\
(a + \epsilon b) (c + \epsilon d) &= ((a c) + \epsilon (b c + a d))
\end{align}
$$</p>
              <p>
                Through power series we can also calculate functions like sin, cos or exp</p>
              <p>
                $$\begin{align}
\sin(a + \epsilon b) &= \sin(a) + \epsilon b \cos(a) \\
\cos(a + \epsilon b) &= \cos(a) - \epsilon b \sin(a) \\
\exp(a + \epsilon b) &= \exp(a) + \epsilon b \exp(a)
\end{align}
$$</p>
              <p>
                In general, for an analytical function <code>(f : ℝ → ℝ)</code> we can show that</p>
              <p>
                $$f(a + \epsilon b) = f(a) + \epsilon b f'(a)
$$</p>
              <p>
                Every dual number is just a pair of two real numbers i.e. \( \overline{\mathbb{R}} \cong \mathbb{R} \times \mathbb{R} \) therefore we can think about the forward mode derivative \(\overrightarrow{\partial} f\) as extension of \(f\) to dual numbers</p>
              <p>
                $$\overrightarrow{\partial} f (x + \epsilon dx) = f(x) + \epsilon f'(x)dx
$$</p>
              </section>
            <section>
              <h3 id="Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Forward-Mode--Exercises">
                2.2.1.3. Exercises</h3>
              <ol start="1">
                <li>
                  <p>
                    In section (??) we defined a function <code>foo</code></p>
                  </li>
                </ol>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6537">def</span> <span class="const token" data-binding="const-foo" data-verso-hover="246">foo</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.511" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="var token" data-binding="var-_uniq.511" data-verso-hover="177">x</span><span class="unknown token" data-binding="">^</span><span class="typed token" data-binding="" data-verso-hover="2">2</span> <span class="unknown token" data-binding="">+</span> <span class="var token" data-binding="var-_uniq.511" data-verso-hover="177">x</span>
<span class="unknown token" data-binding=""></span></code><p>
                In order to compute derivatives with <code>foo</code> you need to derivative generate theorems using <code>def_fun_trans</code> and <code>def_fun_prop</code> macros. Use <code>def_fun_trans</code> macro to generate forward mode derivative rule for <code>foo</code>.</p>
              <ol start="2">
                <li>
                  <p>
                    Newton's method with forward mode AD. In previous chapter (??) we talked about Newton's method. At each iteration we need to compute the function value \( f(x_n)\) and its derivative  \( f'(x_n)\). Instead of evaluating <code>f x</code> and <code>∂! f x</code> use fowrward mode <code>∂&gt;! f x 1</code> to compute the function value and its derivative at the same time.</p>
                  </li>
                <li>
                  <p>
                    Redo the exercises on Newton's method from chapter (??) using forward mode derivative <code>∂&gt;</code> instead of normal derivative <code>∂</code>.</p>
                  </li>
                <li>
                  <p>
                    Prove on paper that the chain rule for forward mode derivative is equivalent to the standard chain rule.</p>
                  </li>
                </ol>
              </section>
            </section>
          <section>
            <h2 id="Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Reverse-Mode">
              2.2.2. Reverse Mode</h2>
            <p>
              Forward mode derivative <code>∂&gt; f</code> is designed to efficiently compute the derivative <code>∂ f</code>. To efficiently compute the gradient <code>∇ f</code> we have to introduce reverse mode derivative <code>&lt;∂ f</code>.</p>
            <p>
              Recall the that definition of the gradient <code>∇ f</code> is adjoint of the derivative</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.variable-7673" data-verso-hover="49">variable</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">×</span><span class="unknown token" data-binding="">ℝ</span> <span class="unknown token" data-binding="">→</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">×</span><span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span>
<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-7720">example</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∇</span> <span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f</span> <span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=</span> <span class="const token" data-binding="const-adjoint" data-verso-hover="208">adjoint</span> <span class="unknown token" data-binding="">ℝ</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">∂</span> <span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f</span> <span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x</span><span class="unknown token" data-binding="">)</span> <span class="typed token" data-binding="" data-verso-hover="177">1</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-8816892496887708595-7769-7771"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-7769" data-verso-hover="67">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-8816892496887708595-7769-7771"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="306">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f✝</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span><span class="const token" data-binding="const-Prod" data-verso-hover="68"> × </span><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span><span class="const token" data-binding="const-Prod" data-verso-hover="68"> × </span><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type">∇ <span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f</span> <span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x</span><span class="const token" data-binding="const-Eq" data-verso-hover="69"> = </span><span class="const token" data-binding="const-adjoint" data-verso-hover="208">adjoint</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> (⇑(∂ <span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f</span> <span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x</span>)) 1</span></span></span></span></span> <span class="tactic"><label for="tactic-state-7-7772-7775"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRfl-7772" data-verso-hover="215">rfl</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-7772-7775"><span class="tactic-state">All goals completed! 🐙</span></span>
<span class="unknown token" data-binding=""></span></code><p>
              One might naively do the same trick as with forward mode derivative and define reverse mode by putting together the function value and the derivative together i.e. <code>&lt;∂ f x dy = (f x, adjoint ℝ (∂ f x) dy)</code>. However, it is not possible to write down a good chain rule for this operation. The only way to do this is to postpone the argument <code>dy</code> and define the reverse mode derivative as</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.variable-8180" data-verso-hover="49">variable</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.527" data-verso-hover="182">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span> <span class="unknown token" data-binding="">→</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span>
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.546" data-verso-hover="300">hf</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.563" data-verso-hover="301">hg</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.527" data-verso-hover="182">g</span><span class="unknown token" data-binding="">)</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-8278">example</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">&lt;∂</span> <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">=</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span><span class="unknown token" data-binding="">,</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-8307">fun</span> <span class="var token" data-binding="var-_uniq.1312" data-verso-hover="177">dy</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="const token" data-binding="const-adjoint" data-verso-hover="208">adjoint</span> <span class="unknown token" data-binding="">ℝ</span> <span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-fderiv" data-verso-hover="176">fderiv</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span><span class="unknown token" data-binding="">)</span> <span class="var token" data-binding="var-_uniq.1312" data-verso-hover="177">dy</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-12625161153689348430-8353-8355"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-8353" data-verso-hover="67">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-12625161153689348430-8353-8355"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="307">hf✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f✝¹</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="308">hg✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g✝</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span><span class="const token" data-binding="const-Prod" data-verso-hover="68"> × </span><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span><span class="const token" data-binding="const-Prod" data-verso-hover="68"> × </span><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.527" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.546" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.563" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.527" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type">&lt;∂ <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span><span class="const token" data-binding="const-Eq" data-verso-hover="69"> = </span>(<span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span>, <span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.2423" data-verso-hover="177">dy</span> =&gt; <span class="const token" data-binding="const-adjoint" data-verso-hover="208">adjoint</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> (⇑(∂ <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x</span>)) <span class="var token" data-binding="var-_uniq.2423" data-verso-hover="177">dy</span>)</span></span></span></span></span> <span class="tactic"><label for="tactic-state-7-8356-8359"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRfl-8356" data-verso-hover="215">rfl</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-8356-8359"><span class="tactic-state">All goals completed! 🐙</span></span>
<span class="unknown token" data-binding=""></span></code><p>
              The reverse mode derivative at point <code>x</code> computes the value <code>f x</code> and a function that can compute the adjoint of the derivative.</p>
            <p>
              With this definition we can write down the chain rule for reverse mode derivative</p>
            <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.variable-8584" data-verso-hover="49">variable</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span> <span class="unknown token" data-binding="">→</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.573" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">:</span> <span class="unknown token" data-binding="">ℝ</span><span class="unknown token" data-binding="">)</span>
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.590" data-verso-hover="300">hf</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.607" data-verso-hover="301">hg</span> <span class="unknown token" data-binding="">:</span> <span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="unknown token" data-binding="">ℝ</span> <span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span><span class="unknown token" data-binding="">)</span>

<span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-8682">example</span> <span class="unknown token" data-binding="">:</span>
  <span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">&lt;∂</span> <span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-8701">fun</span> <span class="var token" data-binding="var-_uniq.1239" data-verso-hover="177">x</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span> <span class="var token" data-binding="var-_uniq.1239" data-verso-hover="177">x</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="var token" data-binding="var-_uniq.573" data-verso-hover="177">x</span><span class="unknown token" data-binding="">)</span>
  <span class="unknown token" data-binding="">=</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8728" data-verso-hover="81">let</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1453" data-verso-hover="177">y</span><span class="unknown token" data-binding="">,</span><span class="var token" data-binding="var-_uniq.1454" data-verso-hover="182">dg'</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">&lt;∂</span> <span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span> <span class="var token" data-binding="var-_uniq.573" data-verso-hover="177">x</span>
  <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8754" data-verso-hover="81">let</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1505" data-verso-hover="177">z</span><span class="unknown token" data-binding="">,</span><span class="var token" data-binding="var-_uniq.1506" data-verso-hover="182">df'</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="unknown token" data-binding="">&lt;∂</span> <span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.1453" data-verso-hover="177">y</span>
  <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1505" data-verso-hover="177">z</span><span class="unknown token" data-binding="">,</span> <span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-8784">fun</span> <span class="var token" data-binding="var-_uniq.1514" data-verso-hover="177">dz</span> <span class="unknown token" data-binding="">=&gt;</span> <span class="var token" data-binding="var-_uniq.1454" data-verso-hover="182">dg'</span> <span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1506" data-verso-hover="182">df'</span> <span class="var token" data-binding="var-_uniq.1514" data-verso-hover="177">dz</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span> <span class="unknown token" data-binding="">:=</span> <span class="tactic"><label for="tactic-state-1231275617545071773-8811-8813"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-8811" data-verso-hover="67">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-1231275617545071773-8811-8813"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f✝²</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.10" data-verso-hover="177">x✝²</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.12" data-verso-hover="177">dx</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.492" data-verso-hover="309">hf✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.4" data-verso-hover="182">f✝²</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.509" data-verso-hover="310">hg✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.8" data-verso-hover="182">g✝¹</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.515" data-verso-hover="183">f✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span><span class="const token" data-binding="const-Prod" data-verso-hover="68"> × </span><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.519" data-verso-hover="181">x✝¹</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span><span class="const token" data-binding="const-Prod" data-verso-hover="68"> × </span><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.527" data-verso-hover="182">g✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.529" data-verso-hover="177">x✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.546" data-verso-hover="306">hf✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.523" data-verso-hover="182">f✝</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.563" data-verso-hover="308">hg✝</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.527" data-verso-hover="182">g✝</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> → <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.573" data-verso-hover="177">x</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.590" data-verso-hover="300">hf</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.607" data-verso-hover="301">hg</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Differentiable" data-verso-hover="241">Differentiable</span> <span class="const token" data-binding="const-Real" data-verso-hover="178">ℝ</span> <span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type">&lt;∂ (<span class="var token" data-binding="var-_uniq.6816" data-verso-hover="177">x</span>:=<span class="var token" data-binding="var-_uniq.573" data-verso-hover="177">x</span>), <span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span> (<span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span> <span class="var token" data-binding="var-_uniq.6816" data-verso-hover="177">x</span>)<span class="const token" data-binding="const-Eq" data-verso-hover="69"> =
  </span><span class="keyword token" data-binding="">match</span> &lt;∂ <span class="var token" data-binding="var-_uniq.571" data-verso-hover="182">g</span> <span class="var token" data-binding="var-_uniq.573" data-verso-hover="177">x</span> <span class="keyword token" data-binding="">with</span>
  | (<span class="var token" data-binding="var-_uniq.6867" data-verso-hover="177">y</span>, <span class="var token" data-binding="var-_uniq.6868" data-verso-hover="182">dg'</span>) =&gt;
    <span class="keyword token" data-binding="">match</span> &lt;∂ <span class="var token" data-binding="var-_uniq.567" data-verso-hover="182">f</span> <span class="var token" data-binding="var-_uniq.6831" data-verso-hover="177">y</span> <span class="keyword token" data-binding="">with</span>
    | (<span class="var token" data-binding="var-_uniq.6857" data-verso-hover="177">z</span>, <span class="var token" data-binding="var-_uniq.6858" data-verso-hover="182">df'</span>) =&gt; (<span class="var token" data-binding="var-_uniq.6847" data-verso-hover="177">z</span>, <span class="keyword token" data-binding="">fun</span> <span class="var token" data-binding="var-_uniq.6853" data-verso-hover="177">dz</span> =&gt; <span class="var token" data-binding="var-_uniq.6832" data-verso-hover="182">dg'</span> (<span class="var token" data-binding="var-_uniq.6848" data-verso-hover="182">df'</span> <span class="var token" data-binding="var-_uniq.6853" data-verso-hover="177">dz</span>))</span></span></span></span></span> <span class="tactic"><label for="tactic-state-7-8814-8823"><span class="keyword token" data-binding="kw-occ-Mathlib.Meta.FunTrans.funTransTacStx-8814">fun_trans</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-8814-8823"><span class="tactic-state">All goals completed! 🐙</span></span>
<span class="unknown token" data-binding=""></span></code><p>
              The crucial observation is that the derivative part of <code>&lt;∂ (f∘g)</code> composes the derivatives of <code>f</code> and <code>g</code> in the reverse order hence the name <strong>reverse mode</strong>.</p>
            <section>
              <h3 id="Scientific-Computing-in-Lean--Differentiation--Automatic-Differentiation--Reverse-Mode--Exercises">
                2.2.2.1. Exercises</h3>
              <ol start="1">
                <li>
                  <p>
                    reimplement gradient descent using <code>revFDeriv</code> and use <code>f x</code> for computing the improvement</p>
                  </li>
                <li>
                  <p>
                    Generate <code>revFDeriv</code> rules for <code>foo</code>.</p>
                  </li>
                <li>
                  <p>
                    SDF projection</p>
                  <ul>
                    <li>
                      <p>
                        sphere</p>
                      </li>
                    <li>
                      <p>
                        pick something from
    https://iquilezles.org/articles/distfunctions/
</p>
                      </li>
                    </ul>
                  </li>
                </ol>
              </section>
            </section>
          </section>
        </main></div>
    </body>
  </html>

